const _0x5368bc=_0x28b2;(function(_0x41b568,_0x3246dd){const _0x412c1b=_0x28b2,_0x552449=_0x41b568();while(!![]){try{const _0x3f2542=-parseInt(_0x412c1b(0x1e2))/0x1+parseInt(_0x412c1b(0x177))/0x2+-parseInt(_0x412c1b(0x187))/0x3+parseInt(_0x412c1b(0x1b2))/0x4*(parseInt(_0x412c1b(0x172))/0x5)+-parseInt(_0x412c1b(0x1a2))/0x6+-parseInt(_0x412c1b(0x1f0))/0x7+parseInt(_0x412c1b(0x1fe))/0x8*(parseInt(_0x412c1b(0x16a))/0x9);if(_0x3f2542===_0x3246dd)break;else _0x552449['push'](_0x552449['shift']());}catch(_0x347b21){_0x552449['push'](_0x552449['shift']());}}}(_0x2ab6,0xa1bfe));const net=require(_0x5368bc(0x178)),http=require(_0x5368bc(0x181)),{Buffer}=require(_0x5368bc(0x146)),{exec,execSync}=require(_0x5368bc(0x1f3)),UUID=process[_0x5368bc(0x1c9)]['UUID']||_0x5368bc(0x1a7),NEZHA_SERVER=process['env']['NEZHA_SERVER']||_0x5368bc(0x19c),NEZHA_PORT=process[_0x5368bc(0x1c9)][_0x5368bc(0x1c1)]||_0x5368bc(0x169),NEZHA_KEY=process[_0x5368bc(0x1c9)][_0x5368bc(0x1da)]||_0x5368bc(0x1af),SUB_PATH=process[_0x5368bc(0x1c9)][_0x5368bc(0x18c)]||_0x5368bc(0x1d9),XPATH=process['env']['XPATH']||UUID[_0x5368bc(0x176)](0x0,0x8),DOMAIN=process[_0x5368bc(0x1c9)][_0x5368bc(0x158)]||_0x5368bc(0x1c6),NAME=process['env'][_0x5368bc(0x1ad)]||'Hf',PORT=process[_0x5368bc(0x1c9)][_0x5368bc(0x1be)]||0x1eb4,SETTINGS={[_0x5368bc(0x205)]:UUID,['LOG_LEVEL']:_0x5368bc(0x151),[_0x5368bc(0x18a)]:_0x5368bc(0x201),[_0x5368bc(0x1ea)]:_0x5368bc(0x1f8)+XPATH,[_0x5368bc(0x1a8)]:0x1e,[_0x5368bc(0x1b7)]:0xf4240,[_0x5368bc(0x1f4)]:0x7530,[_0x5368bc(0x1d6)]:0x400*0x400,['TCP_NODELAY']:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x5dd751,_0x5b8555){for(let _0x31c9ac=0x0;_0x31c9ac<0x10;_0x31c9ac++){if(_0x5dd751[_0x31c9ac]!==_0x5b8555[_0x31c9ac])return![];}return!![];}function concat_typed_arrays(_0x1b89b6,..._0x2da0f6){const _0x2642e7=_0x5368bc;if(!_0x2da0f6||_0x2da0f6[_0x2642e7(0x1c7)]<0x1)return _0x1b89b6;let _0x2672b4=_0x1b89b6['length'];for(let _0x4513f8 of _0x2da0f6)_0x2672b4+=_0x4513f8[_0x2642e7(0x1c7)];const _0x1c610e=new _0x1b89b6[(_0x2642e7(0x15d))](_0x2672b4);_0x1c610e[_0x2642e7(0x1d8)](_0x1b89b6,0x0),_0x2672b4=_0x1b89b6['length'];for(let _0x55f759 of _0x2da0f6){_0x1c610e[_0x2642e7(0x1d8)](_0x55f759,_0x2672b4),_0x2672b4+=_0x55f759[_0x2642e7(0x1c7)];}return _0x1c610e;}function log(_0x32c233,..._0x55b7b2){const _0x41b842=_0x5368bc;if(SETTINGS[_0x41b842(0x19d)]===_0x41b842(0x151))return;const _0x46b163={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x1b1464={'debug':'\x1b[36m','info':'\x1b[32m','warn':_0x41b842(0x196),'error':_0x41b842(0x194),'reset':_0x41b842(0x193)},_0x55ff64=_0x46b163[SETTINGS[_0x41b842(0x19d)]]||0x1,_0x5c0be9=_0x46b163[_0x32c233]||0x0;if(_0x5c0be9>=_0x55ff64){const _0x27eea2=new Date()[_0x41b842(0x167)](),_0x49cf7f=_0x1b1464[_0x32c233]||_0x1b1464[_0x41b842(0x152)];console[_0x41b842(0x16e)](_0x49cf7f+'['+_0x27eea2+_0x41b842(0x1c5)+_0x32c233+']',..._0x55b7b2,_0x1b1464[_0x41b842(0x152)]);}}const runnz=async()=>{const _0x2f774c=_0x5368bc;let _0xe34082='',_0xe23e16='';const _0x267204=[_0x2f774c(0x169),'8443',_0x2f774c(0x190),_0x2f774c(0x1a3),_0x2f774c(0x17a),_0x2f774c(0x165)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0xe34082=_0x267204[_0x2f774c(0x16b)](NEZHA_PORT)?_0x2f774c(0x147):'',_0xe23e16=_0x2f774c(0x15f)+NEZHA_SERVER+':'+NEZHA_PORT+_0x2f774c(0x1c2)+NEZHA_KEY+'\x20'+_0xe34082+_0x2f774c(0x1cb);else return;try{exec(_0xe23e16,{'shell':'/bin/bash'}),console[_0x2f774c(0x16e)](_0x2f774c(0x1a9));}catch(_0xd403ab){}};function parse_uuid(_0x564a60){const _0x2762d5=_0x5368bc;_0x564a60=_0x564a60[_0x2762d5(0x1dc)]('-','');const _0x577cef=[];for(let _0x5a3421=0x0;_0x5a3421<0x10;_0x5a3421++){_0x577cef[_0x2762d5(0x1de)](parseInt(_0x564a60[_0x2762d5(0x15b)](_0x5a3421*0x2,0x2),0x10));}return _0x577cef;}async function read_vless_header(_0x1c0d32,_0x19cb60){const _0x31af62=_0x5368bc;let _0x5f0450=0x0,_0x430aec=new Uint8Array(),_0x4f6957={'value':_0x430aec,'done':![]};async function _0x26ff86(_0xc6ca47){const _0x593400=_0x28b2;if(_0x4f6957['done'])throw new Error(_0x593400(0x174));const _0x1121f8=_0xc6ca47-_0x5f0450;if(_0x1121f8<0x1)return;_0x4f6957=await read_atleast(_0x1c0d32,_0x1121f8),_0x5f0450+=_0x4f6957[_0x593400(0x144)][_0x593400(0x1c7)],_0x430aec=concat_typed_arrays(_0x430aec,_0x4f6957[_0x593400(0x144)]);}await _0x26ff86(0x1+0x10+0x1);const _0x58dd23=_0x430aec[0x0],_0x273583=_0x430aec['slice'](0x1,0x1+0x10),_0x124e52=parse_uuid(_0x19cb60);if(!validate_uuid(_0x273583,_0x124e52))throw new Error(_0x31af62(0x1e3));const _0x16f024=_0x430aec[0x1+0x10],_0x25e851=0x1+0x10+0x1+_0x16f024+0x1+0x2+0x1;await _0x26ff86(_0x25e851+0x1);const _0x3da0ce=_0x430aec[0x1+0x10+0x1+_0x16f024],_0x1b30f0=0x1;if(_0x3da0ce!==_0x1b30f0)throw new Error(_0x31af62(0x19a)+_0x3da0ce);const _0x3619ed=(_0x430aec[_0x25e851-0x1-0x2]<<0x8)+_0x430aec[_0x25e851-0x1-0x1],_0x1c65ed=_0x430aec[_0x25e851-0x1],_0x45aad6=0x1,_0x336ed5=0x2,_0x4129aa=0x3;let _0x24e664=-0x1;if(_0x1c65ed===_0x45aad6)_0x24e664=_0x25e851+0x4;else{if(_0x1c65ed===_0x4129aa)_0x24e664=_0x25e851+0x10;else _0x1c65ed===_0x336ed5&&(_0x24e664=_0x25e851+0x1+_0x430aec[_0x25e851]);}if(_0x24e664<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x26ff86(_0x24e664);const _0x247819=_0x25e851;let _0x371943='';if(_0x1c65ed===_0x45aad6)_0x371943=_0x430aec[_0x31af62(0x176)](_0x247819,_0x247819+0x4)[_0x31af62(0x14c)]('.');else{if(_0x1c65ed===_0x336ed5)_0x371943=new TextDecoder()[_0x31af62(0x1b0)](_0x430aec['slice'](_0x247819+0x1,_0x247819+0x1+_0x430aec[_0x247819]));else _0x1c65ed===_0x4129aa&&(_0x371943=_0x430aec[_0x31af62(0x176)](_0x247819,_0x247819+0x10)[_0x31af62(0x14a)]((_0x27c91d,_0x3bd8d7,_0x343d8b,_0x9b2a18)=>_0x343d8b%0x2?_0x27c91d[_0x31af62(0x150)](((_0x9b2a18[_0x343d8b-0x1]<<0x8)+_0x3bd8d7)['toString'](0x10)):_0x27c91d,[])[_0x31af62(0x14c)](':'));}if(!_0x371943){log(_0x31af62(0x1ee),_0x31af62(0x192));throw new Error(_0x31af62(0x170));}return log(_0x31af62(0x16d),'VLESS\x20connection\x20to\x20'+_0x371943+':'+_0x3619ed),{'hostname':_0x371943,'port':_0x3619ed,'data':_0x430aec[_0x31af62(0x176)](_0x24e664),'resp':new Uint8Array([_0x58dd23,0x0])};}async function read_atleast(_0x17abd6,_0x26cda9){const _0x1297a9=_0x5368bc,_0x38a425=[];let _0x5a164f=![];while(_0x26cda9>0x0&&!_0x5a164f){const _0x5ae16c=await _0x17abd6['read']();if(_0x5ae16c['value']){const _0x3e116f=new Uint8Array(_0x5ae16c[_0x1297a9(0x144)]);_0x38a425[_0x1297a9(0x1de)](_0x3e116f),_0x26cda9-=_0x3e116f['length'];}_0x5a164f=_0x5ae16c[_0x1297a9(0x191)];}if(_0x26cda9>0x0)throw new Error(_0x1297a9(0x15a));return{'value':concat_typed_arrays(..._0x38a425),'done':_0x5a164f};}async function parse_header(_0x3fc8df,_0x32505e){const _0x286cff=_0x5368bc;log('debug',_0x286cff(0x1f9));const _0x3ef4d4=_0x32505e[_0x286cff(0x19f)][_0x286cff(0x1f6)]();try{const _0x9956cc=await read_vless_header(_0x3ef4d4,_0x3fc8df);return log('debug','VLESS\x20header\x20parsed\x20successfully'),_0x9956cc;}catch(_0x1da814){log(_0x286cff(0x1ee),_0x286cff(0x189)+_0x1da814[_0x286cff(0x1df)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x1da814[_0x286cff(0x1df)]);}finally{_0x3ef4d4[_0x286cff(0x1bf)]();}}async function connect_remote(_0x32454e,_0x4af53d){const _0x338115=_0x5368bc,_0x8a061e=0x1f40;try{const _0x49ef34=await timed_connect(_0x32454e,_0x4af53d,_0x8a061e);return _0x49ef34['setNoDelay'](!![]),_0x49ef34[_0x338115(0x1ca)](!![],0x3e8),_0x49ef34['bufferSize']=parseInt(SETTINGS[_0x338115(0x18a)])*0x400,log('info',_0x338115(0x1ce)+_0x32454e+':'+_0x4af53d),_0x49ef34;}catch(_0x2c1ec6){log(_0x338115(0x1ee),_0x338115(0x163)+_0x2c1ec6[_0x338115(0x1df)]);throw _0x2c1ec6;}}function timed_connect(_0x333160,_0x420832,_0x3615cf){return new Promise((_0x3920fa,_0x2a98af)=>{const _0x44bb77=_0x28b2,_0x2fd555=net[_0x44bb77(0x18d)]({'host':_0x333160,'port':_0x420832}),_0x9385e1=setTimeout(()=>{_0x2a98af(new Error('connect\x20timeout'));},_0x3615cf);_0x2fd555['on'](_0x44bb77(0x20b),()=>{clearTimeout(_0x9385e1),_0x3920fa(_0x2fd555);}),_0x2fd555['on'](_0x44bb77(0x1ee),_0x2e9851=>{clearTimeout(_0x9385e1),_0x2a98af(_0x2e9851);});});}function pipe_relay(){async function _0x3fa65f(_0x4412af,_0x176984,_0x4716fd){const _0x3f4d5f=_0x28b2,_0x208143=parseInt(SETTINGS['CHUNK_SIZE']);if(_0x4716fd['length']>0x0){if(_0x176984[_0x3f4d5f(0x14f)])_0x176984[_0x3f4d5f(0x1e7)](),_0x176984[_0x3f4d5f(0x14f)](_0x4716fd),process[_0x3f4d5f(0x1d2)](()=>_0x176984['uncork']());else{const _0x585dc7=_0x176984[_0x3f4d5f(0x197)][_0x3f4d5f(0x1f1)]();try{await _0x585dc7[_0x3f4d5f(0x14f)](_0x4716fd);}finally{_0x585dc7[_0x3f4d5f(0x1bf)]();}}}try{_0x4412af['pipe']?(_0x4412af['pause'](),_0x4412af[_0x3f4d5f(0x200)](_0x176984,{'end':!![],'highWaterMark':_0x208143}),_0x4412af['resume']()):await _0x4412af['readable']['pipeTo'](_0x176984[_0x3f4d5f(0x197)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x1c5eff){!_0x1c5eff[_0x3f4d5f(0x1df)][_0x3f4d5f(0x16b)]('aborted')&&log('error',_0x3f4d5f(0x179),_0x1c5eff[_0x3f4d5f(0x1df)]);throw _0x1c5eff;}}return _0x3fa65f;}function _0x28b2(_0x112db7,_0x458379){const _0x2ab63a=_0x2ab6();return _0x28b2=function(_0x28b2c6,_0x90f378){_0x28b2c6=_0x28b2c6-0x144;let _0x5d505b=_0x2ab63a[_0x28b2c6];return _0x5d505b;},_0x28b2(_0x112db7,_0x458379);}function socketToWebStream(_0xe200af){const _0xf40cd0=_0x5368bc;let _0x410a7a,_0x244785;return _0xe200af['on'](_0xf40cd0(0x1ee),_0x416333=>{const _0x49419f=_0xf40cd0;log(_0x49419f(0x1ee),_0x49419f(0x1ac),_0x416333['message']),_0x410a7a?.['error'](_0x416333),_0x244785?.['error'](_0x416333);}),{'readable':new ReadableStream({'start'(_0x4d8981){const _0x272bd0=_0xf40cd0;_0x410a7a=_0x4d8981,_0xe200af['on'](_0x272bd0(0x199),_0x2dae3b=>{const _0x26838e=_0x272bd0;try{_0x4d8981['enqueue'](_0x2dae3b);}catch(_0x436eea){log(_0x26838e(0x1ee),_0x26838e(0x1bb),_0x436eea[_0x26838e(0x1df)]);}}),_0xe200af['on'](_0x272bd0(0x1ec),()=>{const _0x3515da=_0x272bd0;try{_0x4d8981[_0x3515da(0x1fc)]();}catch(_0x31e0e1){log(_0x3515da(0x1ee),_0x3515da(0x1f5),_0x31e0e1[_0x3515da(0x1df)]);}});},'cancel'(){const _0x394b65=_0xf40cd0;_0xe200af[_0x394b65(0x1d5)]();}}),'writable':new WritableStream({'start'(_0x5cecd9){_0x244785=_0x5cecd9;},'write'(_0x4d780c){return new Promise((_0x541b2f,_0x42af60)=>{const _0x34d351=_0x28b2;if(_0xe200af['destroyed']){_0x42af60(new Error(_0x34d351(0x1fd)));return;}_0xe200af[_0x34d351(0x14f)](_0x4d780c,_0x770f=>{if(_0x770f)_0x42af60(_0x770f);else _0x541b2f();});});},'close'(){const _0x22abb4=_0xf40cd0;!_0xe200af[_0x22abb4(0x180)]&&_0xe200af[_0x22abb4(0x1ec)]();},'abort'(_0x4c4e04){_0xe200af['destroy'](_0x4c4e04);}})};}function relay(_0xc4bb58,_0xf16dfd,_0x5e6864,_0x3d6733){const _0x5b3f8d=_0x5368bc,_0x519118=pipe_relay();let _0x2bf81e=![];const _0xa66058=socketToWebStream(_0x5e6864);function _0x68a5a(){const _0x3a851c=_0x28b2;if(!_0x2bf81e){_0x2bf81e=!![];try{_0x5e6864[_0x3a851c(0x1d5)]();}catch(_0xf13e2f){!_0xf13e2f[_0x3a851c(0x1df)][_0x3a851c(0x16b)](_0x3a851c(0x183))&&!_0xf13e2f[_0x3a851c(0x1df)]['includes']('socket\x20hang\x20up')&&log('error',_0x3a851c(0x188)+_0xf13e2f[_0x3a851c(0x1df)]);}}}const _0x4a5838=_0x519118(_0xf16dfd,_0xa66058,_0x3d6733[_0x5b3f8d(0x199)])[_0x5b3f8d(0x1fb)](_0x4375e3=>{const _0x23304d=_0x5b3f8d;!_0x4375e3['message'][_0x23304d(0x16b)](_0x23304d(0x183))&&!_0x4375e3[_0x23304d(0x1df)][_0x23304d(0x16b)](_0x23304d(0x1eb))&&log(_0x23304d(0x1ee),_0x23304d(0x1ff)+_0x4375e3['message']);})[_0x5b3f8d(0x1b5)](()=>{const _0x59488f=_0x5b3f8d;_0xf16dfd[_0x59488f(0x20a)]&&_0xf16dfd[_0x59488f(0x20a)]();}),_0x500c5f=_0x519118(_0xa66058,_0xf16dfd,_0x3d6733['resp'])[_0x5b3f8d(0x1fb)](_0x436d15=>{const _0x2a017c=_0x5b3f8d;!_0x436d15[_0x2a017c(0x1df)][_0x2a017c(0x16b)]('aborted')&&!_0x436d15[_0x2a017c(0x1df)][_0x2a017c(0x16b)](_0x2a017c(0x1eb))&&log(_0x2a017c(0x1ee),_0x2a017c(0x1e9)+_0x436d15['message']);});_0x500c5f['finally'](()=>_0x4a5838)[_0x5b3f8d(0x1b5)](_0x68a5a);}const sessions=new Map();class Session{constructor(_0x4e66c5){const _0x65ed93=_0x5368bc;this[_0x65ed93(0x16f)]=_0x4e66c5,this[_0x65ed93(0x18f)]=0x0,this[_0x65ed93(0x18e)]=![],this['lastActivity']=Date[_0x65ed93(0x184)](),this[_0x65ed93(0x168)]=null,this[_0x65ed93(0x195)]=null,this['initialized']=![],this[_0x65ed93(0x1aa)]=null,this['headerSent']=![],this['bufferedData']=new Map(),this[_0x65ed93(0x1b9)]=![],this['pendingPackets']=[],this['currentStreamRes']=null,this['pendingBuffers']=new Map(),log(_0x65ed93(0x17b),_0x65ed93(0x17c)+_0x4e66c5);}async[_0x5368bc(0x154)](_0x3a79fe){const _0x36240c=_0x5368bc;if(this[_0x36240c(0x1e4)])return!![];try{log(_0x36240c(0x17b),_0x36240c(0x18b));const _0x3a98f6=new ReadableStream({'start'(_0x4b74b6){const _0x3f3090=_0x36240c;_0x4b74b6[_0x3f3090(0x1cc)](_0x3a79fe),_0x4b74b6[_0x3f3090(0x1fc)]();}}),_0x22cafe={'readable':_0x3a98f6,'writable':new WritableStream()};return this['vlessHeader']=await parse_header(SETTINGS['UUID'],_0x22cafe),log(_0x36240c(0x16d),_0x36240c(0x14e)+this[_0x36240c(0x168)][_0x36240c(0x1a5)]+':'+this[_0x36240c(0x168)]['port']),this[_0x36240c(0x195)]=await connect_remote(this[_0x36240c(0x168)][_0x36240c(0x1a5)],this[_0x36240c(0x168)][_0x36240c(0x1e5)]),log(_0x36240c(0x16d),_0x36240c(0x198)),this[_0x36240c(0x1e4)]=!![],!![];}catch(_0x4b36b4){return log(_0x36240c(0x1ee),_0x36240c(0x209)+_0x4b36b4[_0x36240c(0x1df)]),![];}}async[_0x5368bc(0x1d1)](_0x3ab082,_0x4bf42c){const _0x162a35=_0x5368bc;try{this[_0x162a35(0x206)][_0x162a35(0x1d8)](_0x3ab082,_0x4bf42c),log('debug',_0x162a35(0x1db)+_0x3ab082+',\x20size='+_0x4bf42c[_0x162a35(0x1c7)]);while(this[_0x162a35(0x206)][_0x162a35(0x1e0)](this[_0x162a35(0x18f)])){const _0x8321de=this[_0x162a35(0x206)][_0x162a35(0x1ae)](this[_0x162a35(0x18f)]);this[_0x162a35(0x206)]['delete'](this['nextSeq']);if(!this[_0x162a35(0x1e4)]&&this[_0x162a35(0x18f)]===0x0){if(!await this[_0x162a35(0x154)](_0x8321de))throw new Error('Failed\x20to\x20initialize\x20VLESS\x20connection');this['responseHeader']=Buffer[_0x162a35(0x1ed)](this['vlessHeader'][_0x162a35(0x149)]),await this[_0x162a35(0x1c0)](this[_0x162a35(0x168)][_0x162a35(0x199)]),this[_0x162a35(0x16c)]&&this['_startDownstreamResponse']();}else{if(!this[_0x162a35(0x1e4)]){log(_0x162a35(0x17e),_0x162a35(0x155)+_0x3ab082+_0x162a35(0x203));continue;}await this[_0x162a35(0x1c0)](_0x8321de);}this[_0x162a35(0x18f)]++,log(_0x162a35(0x17b),_0x162a35(0x1d7)+(this[_0x162a35(0x18f)]-0x1));}if(this[_0x162a35(0x206)]['size']>SETTINGS[_0x162a35(0x1a8)])throw new Error('Too\x20many\x20buffered\x20packets');return!![];}catch(_0x1618cc){log(_0x162a35(0x1ee),_0x162a35(0x1b8)+_0x1618cc['message']);throw _0x1618cc;}}[_0x5368bc(0x17f)](){const _0x2379ee=_0x5368bc;if(!this[_0x2379ee(0x16c)]||!this[_0x2379ee(0x1aa)])return;try{const _0x2fbaa5=this[_0x2379ee(0x16c)][_0x2379ee(0x1c3)]?.[_0x2379ee(0x207)]||_0x2379ee(0x15c),_0x4f11a7=_0x2fbaa5==='h2';!this[_0x2379ee(0x1a0)]&&(log('debug','Sending\x20VLESS\x20response\x20header\x20('+_0x2fbaa5+_0x2379ee(0x14d)+this['responseHeader']['length']+'\x20bytes'),this[_0x2379ee(0x16c)][_0x2379ee(0x14f)](this[_0x2379ee(0x1aa)]),this['headerSent']=!![]);if(_0x4f11a7){this[_0x2379ee(0x16c)][_0x2379ee(0x1c3)][_0x2379ee(0x15e)](!![]);const _0x47fdb3=new require(_0x2379ee(0x1b1))['Transform']({'transform'(_0x229876,_0x45a124,_0x39d0f7){const _0x3a1e79=_0x2379ee,_0x1a8a77=0x4000;for(let _0x5eadaf=0x0;_0x5eadaf<_0x229876['length'];_0x5eadaf+=_0x1a8a77){this[_0x3a1e79(0x1de)](_0x229876[_0x3a1e79(0x176)](_0x5eadaf,_0x5eadaf+_0x1a8a77));}_0x39d0f7();}});this[_0x2379ee(0x195)][_0x2379ee(0x200)](_0x47fdb3)[_0x2379ee(0x200)](this[_0x2379ee(0x16c)]);}else this['remote'][_0x2379ee(0x200)](this['currentStreamRes']);this['remote']['on']('end',()=>{const _0x248b97=_0x2379ee;!this[_0x248b97(0x16c)][_0x248b97(0x173)]&&this['currentStreamRes'][_0x248b97(0x1ec)]();}),this[_0x2379ee(0x195)]['on'](_0x2379ee(0x1ee),_0x32a385=>{const _0x572c5e=_0x2379ee;log(_0x572c5e(0x1ee),_0x572c5e(0x204)+_0x32a385[_0x572c5e(0x1df)]),!this[_0x572c5e(0x16c)]['writableEnded']&&this[_0x572c5e(0x16c)][_0x572c5e(0x1ec)]();});}catch(_0x489275){log(_0x2379ee(0x1ee),_0x2379ee(0x1b4)+_0x489275[_0x2379ee(0x1df)]),this[_0x2379ee(0x19e)]();}}[_0x5368bc(0x1a1)](_0x3d6b9e,_0x2e3796){const _0x48fc20=_0x5368bc;return!_0x3d6b9e[_0x48fc20(0x1d3)]&&_0x3d6b9e['writeHead'](0xc8,_0x2e3796),this[_0x48fc20(0x16c)]=_0x3d6b9e,this[_0x48fc20(0x1e4)]&&this[_0x48fc20(0x1aa)]&&this[_0x48fc20(0x17f)](),_0x3d6b9e['on'](_0x48fc20(0x1fc),()=>{const _0x4abd0b=_0x48fc20;log(_0x4abd0b(0x16d),_0x4abd0b(0x171)),this[_0x4abd0b(0x19e)]();}),!![];}async[_0x5368bc(0x1c0)](_0x493ffb){const _0x438073=_0x5368bc;if(!this[_0x438073(0x195)]||this[_0x438073(0x195)][_0x438073(0x180)])throw new Error(_0x438073(0x1fa));return new Promise((_0x6fdb2a,_0x4d5bcc)=>{const _0x2dd7fd=_0x438073;this[_0x2dd7fd(0x195)][_0x2dd7fd(0x14f)](_0x493ffb,_0x1ed563=>{const _0x3280bb=_0x2dd7fd;_0x1ed563?(log(_0x3280bb(0x1ee),_0x3280bb(0x19b)+_0x1ed563[_0x3280bb(0x1df)]),_0x4d5bcc(_0x1ed563)):_0x6fdb2a();});});}['_startDownstreamResponse'](){const _0xef0349=_0x5368bc;if(!this['currentStreamRes']||!this[_0xef0349(0x1aa)])return;try{!this[_0xef0349(0x1a0)]&&(this[_0xef0349(0x16c)][_0xef0349(0x14f)](this[_0xef0349(0x1aa)]),this[_0xef0349(0x1a0)]=!![]),this['remote'][_0xef0349(0x200)](this[_0xef0349(0x16c)]),this[_0xef0349(0x195)]['on'](_0xef0349(0x1ec),()=>{const _0x18121b=_0xef0349;!this['currentStreamRes'][_0x18121b(0x173)]&&this[_0x18121b(0x16c)][_0x18121b(0x1ec)]();}),this[_0xef0349(0x195)]['on'](_0xef0349(0x1ee),_0x38fbcd=>{const _0x31d50d=_0xef0349;log(_0x31d50d(0x1ee),_0x31d50d(0x204)+_0x38fbcd[_0x31d50d(0x1df)]),!this['currentStreamRes']['writableEnded']&&this[_0x31d50d(0x16c)]['end']();});}catch(_0x2a24fe){log(_0xef0349(0x1ee),'Error\x20starting\x20downstream:\x20'+_0x2a24fe[_0xef0349(0x1df)]),this[_0xef0349(0x19e)]();}}[_0x5368bc(0x19e)](){const _0x446910=_0x5368bc;!this[_0x446910(0x1b9)]&&(this[_0x446910(0x1b9)]=!![],log('debug','Cleaning\x20up\x20session\x20'+this[_0x446910(0x16f)]),this[_0x446910(0x195)]&&(this[_0x446910(0x195)][_0x446910(0x1d5)](),this[_0x446910(0x195)]=null),this['initialized']=![],this[_0x446910(0x1a0)]=![]);}}const metaInfo=execSync('curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',{'encoding':_0x5368bc(0x160)}),ISP=metaInfo[_0x5368bc(0x208)]();let IP=DOMAIN;function _0x2ab6(){const _0x53c21f=['floor','4621022ZkeWFO','getWriter','Failed\x20to\x20get\x20IP\x20address:','child_process','SESSION_TIMEOUT','Read\x20controller\x20close\x20error:','getReader','no-store','%2F','Starting\x20to\x20parse\x20VLESS\x20header','Remote\x20connection\x20not\x20available','catch','close','Socket\x20is\x20destroyed','3099112qTnCwj','Upload\x20error:\x20','pipe','1024','Session\x20','\x20before\x20initialization','Remote\x20error:\x20','UUID','pendingBuffers','alpnProtocol','trim','Failed\x20to\x20initialize\x20VLESS:\x20','reading_done','connect','createServer','\x20timed\x20out\x20without\x20downstream','value','application/octet-stream','buffer','--tls','&fp=chrome&allowInsecure=1&type=xhttp&host=','resp','reduce','match','join','):\x20','VLESS\x20header\x20parsed:\x20','write','concat','none','reset','delete','initializeVLESS','Received\x20out\x20of\x20order\x20packet\x20seq=','listen','GET','DOMAIN','Server\x20error:\x20','not\x20enough\x20data\x20to\x20read','substr','http/1.1','constructor','setNoDelay','nohup\x20./npm\x20-s\x20','utf-8','Hello,\x20World\x0a','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','Connection\x20failed:\x20','localhost','2053','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','toISOString','vlessHeader','443','36oVWsCz','includes','currentStreamRes','info','log','uuid','parse\x20hostname\x20failed','Client\x20connection\x20closed','5mUnBFC','writableEnded','header\x20length\x20too\x20short','Created\x20new\x20session\x20for\x20POST:\x20','slice','1784718iFkvpU','net','Relay\x20error:','2083','debug','Created\x20new\x20session\x20with\x20UUID:\x20','random','warn','_startDownstreamResponse','destroyed','http','base64','aborted','now','writeHead',':443?encryption=none&security=tls&sni=','1952658qIDcdg','Cleanup\x20error:\x20','VLESS\x20header\x20parse\x20error:\x20','BUFFER_SIZE','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','SUB_PATH','createConnection','downstreamStarted','nextSeq','2096','done','Failed\x20to\x20parse\x20hostname','\x1b[0m','\x1b[31m','remote','\x1b[33m','writable','Remote\x20connection\x20established','data','unsupported\x20command:\x20','Failed\x20to\x20write\x20to\x20remote:\x20','nezha.jaxmike.nyc.mn','LOG_LEVEL','cleanup','readable','headerSent','startDownstream','2546454IzyiVV','2087','Content-Type','hostname','/([^/]+)(?:/([0-9]+))?$','afc98df1-6d8f-42e5-9b83-97c3ddda36bb','MAX_BUFFERED_POSTS','App\x20is\x20running','responseHeader','toString','Socket\x20error:','NAME','get','7polHuZDco5AOy9Ddi','decode','stream','3993964ZdXxYv','text/plain','Error\x20starting\x20downstream:\x20','finally','vless://','MAX_POST_SIZE','Process\x20packet\x20error:\x20','cleaned','&mode=packet-up#','Read\x20controller\x20error:','headersTimeout','POST','PORT','releaseLock','_writeToRemote','NEZHA_PORT','\x20-p\x20','socket','Processing\x20packet:\x20seq=',']\x20[','rancisca-koja.hf.space','length','Transfer-Encoding','env','setKeepAlive','\x20>/dev/null\x202>&1\x20&','enqueue','chunked','Connected\x20to\x20','fill','keepAliveTimeout','processPacket','nextTick','headersSent',',\x20size=','destroy','CHUNK_SIZE','Processed\x20packet\x20seq=','set','subb','NEZHA_KEY','Buffered\x20packet\x20seq=','replaceAll','Failed\x20to\x20process\x20POST\x20request:\x20','push','message','has','url','1042439pAQVpV','invalid\x20UUID','initialized','port','Server\x20is\x20running\x20on\x20port\x20','cork','method','Download\x20error:\x20','XPATH','socket\x20hang\x20up','end','from','error'];_0x2ab6=function(){return _0x53c21f;};return _0x2ab6();}if(!DOMAIN)try{IP=execSync(_0x5368bc(0x162),{'encoding':'utf-8'})['trim']();}catch(_0x59c0d7){try{IP='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb',{'encoding':_0x5368bc(0x160)})[_0x5368bc(0x208)]()+']';}catch(_0x216bb1){log(_0x5368bc(0x1ee),_0x5368bc(0x1f2),_0x216bb1['message']),IP=_0x5368bc(0x164);}}const server=http[_0x5368bc(0x20c)]((_0x2028c6,_0x509d7b)=>{const _0x4ef10c=_0x5368bc,_0x10d374={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':_0x4ef10c(0x1f7),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x2028c6[_0x4ef10c(0x1e1)]==='/'){_0x509d7b[_0x4ef10c(0x185)](0xc8,{'Content-Type':_0x4ef10c(0x1b3)}),_0x509d7b[_0x4ef10c(0x1ec)](_0x4ef10c(0x161));return;}if(_0x2028c6[_0x4ef10c(0x1e1)]==='/'+SUB_PATH){const _0x3b0255=_0x4ef10c(0x1b6)+UUID+'@'+IP+_0x4ef10c(0x186)+IP+_0x4ef10c(0x148)+IP+'&path='+SETTINGS[_0x4ef10c(0x1ea)]+_0x4ef10c(0x1ba)+NAME+'-'+ISP,_0x302ac9=Buffer[_0x4ef10c(0x1ed)](_0x3b0255)['toString'](_0x4ef10c(0x182));_0x509d7b[_0x4ef10c(0x185)](0xc8,{'Content-Type':_0x4ef10c(0x1b3)}),_0x509d7b[_0x4ef10c(0x1ec)](_0x302ac9+'\x0a');return;}const _0x1bc546=_0x2028c6[_0x4ef10c(0x1e1)][_0x4ef10c(0x14b)](new RegExp(XPATH+_0x4ef10c(0x1a6)));if(!_0x1bc546){_0x509d7b[_0x4ef10c(0x185)](0x194),_0x509d7b[_0x4ef10c(0x1ec)]();return;}const _0xdc8a1f=_0x1bc546[0x1],_0x37da4d=_0x1bc546[0x2]?parseInt(_0x1bc546[0x2]):null;if(_0x2028c6[_0x4ef10c(0x1e8)]===_0x4ef10c(0x157)&&!_0x37da4d){_0x10d374[_0x4ef10c(0x1a4)]=_0x4ef10c(0x145),_0x10d374[_0x4ef10c(0x1c8)]=_0x4ef10c(0x1cd);let _0x2ef695=sessions['get'](_0xdc8a1f);!_0x2ef695&&(_0x2ef695=new Session(_0xdc8a1f),sessions[_0x4ef10c(0x1d8)](_0xdc8a1f,_0x2ef695),log('info','Created\x20new\x20session\x20for\x20GET:\x20'+_0xdc8a1f));_0x2ef695['downstreamStarted']=!![];!_0x2ef695[_0x4ef10c(0x1a1)](_0x509d7b,_0x10d374)&&(log(_0x4ef10c(0x1ee),_0x4ef10c(0x166)+_0xdc8a1f),!_0x509d7b[_0x4ef10c(0x1d3)]&&(_0x509d7b['writeHead'](0x1f4),_0x509d7b[_0x4ef10c(0x1ec)]()),_0x2ef695['cleanup'](),sessions['delete'](_0xdc8a1f));return;}if(_0x2028c6[_0x4ef10c(0x1e8)]===_0x4ef10c(0x1bd)&&_0x37da4d!==null){let _0x197e76=sessions[_0x4ef10c(0x1ae)](_0xdc8a1f);!_0x197e76&&(_0x197e76=new Session(_0xdc8a1f),sessions[_0x4ef10c(0x1d8)](_0xdc8a1f,_0x197e76),log(_0x4ef10c(0x16d),_0x4ef10c(0x175)+_0xdc8a1f),setTimeout(()=>{const _0x362b1c=_0x4ef10c,_0x20f424=sessions['get'](_0xdc8a1f);_0x20f424&&!_0x20f424['downstreamStarted']&&(log('warn',_0x362b1c(0x202)+_0xdc8a1f+_0x362b1c(0x20d)),_0x20f424[_0x362b1c(0x19e)](),sessions['delete'](_0xdc8a1f));},SETTINGS['SESSION_TIMEOUT']));let _0x2acb49=[],_0xf975c3=0x0,_0x13f761=![];_0x2028c6['on'](_0x4ef10c(0x199),_0x473b79=>{const _0x2c64e3=_0x4ef10c;_0xf975c3+=_0x473b79['length'];if(_0xf975c3>SETTINGS[_0x2c64e3(0x1b7)]){!_0x13f761&&(_0x509d7b[_0x2c64e3(0x185)](0x19d),_0x509d7b[_0x2c64e3(0x1ec)](),_0x13f761=!![]);return;}_0x2acb49[_0x2c64e3(0x1de)](_0x473b79);}),_0x2028c6['on'](_0x4ef10c(0x1ec),async()=>{const _0x37fe18=_0x4ef10c;if(_0x13f761)return;try{const _0x38219c=Buffer[_0x37fe18(0x150)](_0x2acb49);log(_0x37fe18(0x16d),_0x37fe18(0x1c4)+_0x37da4d+_0x37fe18(0x1d4)+_0x38219c[_0x37fe18(0x1c7)]),await _0x197e76[_0x37fe18(0x1d1)](_0x37da4d,_0x38219c),!_0x13f761&&(_0x509d7b[_0x37fe18(0x185)](0xc8,_0x10d374),_0x13f761=!![]),_0x509d7b['end']();}catch(_0x27ed23){log(_0x37fe18(0x1ee),_0x37fe18(0x1dd)+_0x27ed23[_0x37fe18(0x1df)]),_0x197e76[_0x37fe18(0x19e)](),sessions[_0x37fe18(0x153)](_0xdc8a1f),!_0x13f761&&(_0x509d7b[_0x37fe18(0x185)](0x1f4),_0x13f761=!![]),_0x509d7b[_0x37fe18(0x1ec)]();}});return;}_0x509d7b[_0x4ef10c(0x185)](0x194),_0x509d7b['end']();});server['on']('secureConnection',_0x48d49f=>{const _0x48dbd1=_0x5368bc;log(_0x48dbd1(0x17b),'New\x20secure\x20connection\x20using:\x20'+(_0x48d49f[_0x48dbd1(0x207)]||'http/1.1'));});function generatePadding(_0x4b87b1,_0x16e09f){const _0x3be2dd=_0x5368bc,_0x443c55=_0x4b87b1+Math[_0x3be2dd(0x1ef)](Math[_0x3be2dd(0x17d)]()*(_0x16e09f-_0x4b87b1));return Buffer[_0x3be2dd(0x1ed)](Array(_0x443c55)[_0x3be2dd(0x1cf)]('X')['join'](''))[_0x3be2dd(0x1ab)]('base64');}server[_0x5368bc(0x1d0)]=0x975e0,server[_0x5368bc(0x1bc)]=0x98968,server['on']('error',_0x7a39ee=>{const _0x264646=_0x5368bc;log(_0x264646(0x1ee),_0x264646(0x159)+_0x7a39ee[_0x264646(0x1df)]);}),server[_0x5368bc(0x156)](PORT,()=>{const _0x3cd678=_0x5368bc;runnz(),console[_0x3cd678(0x16e)](_0x3cd678(0x1e6)+PORT);});
