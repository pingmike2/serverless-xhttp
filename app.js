const _0x1b1650=_0x1a30;(function(_0x1eb2a0,_0x18f48f){const _0x3576c6=_0x1a30,_0x542734=_0x1eb2a0();while(!![]){try{const _0x2f1d91=parseInt(_0x3576c6(0x11a))/0x1*(-parseInt(_0x3576c6(0x114))/0x2)+-parseInt(_0x3576c6(0xd0))/0x3*(-parseInt(_0x3576c6(0xe4))/0x4)+-parseInt(_0x3576c6(0x14c))/0x5+parseInt(_0x3576c6(0x107))/0x6*(parseInt(_0x3576c6(0xa4))/0x7)+-parseInt(_0x3576c6(0x157))/0x8*(-parseInt(_0x3576c6(0xff))/0x9)+parseInt(_0x3576c6(0x145))/0xa*(-parseInt(_0x3576c6(0x11c))/0xb)+parseInt(_0x3576c6(0x8e))/0xc;if(_0x2f1d91===_0x18f48f)break;else _0x542734['push'](_0x542734['shift']());}catch(_0x1df176){_0x542734['push'](_0x542734['shift']());}}}(_0x2212,0x6bf58));const net=require(_0x1b1650(0xa3)),http=require(_0x1b1650(0x12b)),{Buffer}=require('buffer'),{exec,execSync}=require(_0x1b1650(0xda)),UUID=process['env'][_0x1b1650(0xcf)]||_0x1b1650(0xcb),NEZHA_SERVER=process['env'][_0x1b1650(0x15a)]||_0x1b1650(0x10d),NEZHA_PORT=process[_0x1b1650(0x9b)][_0x1b1650(0x13b)]||_0x1b1650(0xfd),NEZHA_KEY=process['env'][_0x1b1650(0x14a)]||_0x1b1650(0x143),SUB_PATH=process[_0x1b1650(0x9b)][_0x1b1650(0xe2)]||_0x1b1650(0xc3),XPATH=process['env'][_0x1b1650(0x14b)]||UUID[_0x1b1650(0x12d)](0x0,0x8),DOMAIN=process[_0x1b1650(0x9b)][_0x1b1650(0xe0)]||_0x1b1650(0x132),NAME=process['env'][_0x1b1650(0x13c)]||'Hf',PORT=process['env']['PORT']||0x1eb4,SETTINGS={[_0x1b1650(0xcf)]:UUID,[_0x1b1650(0xc8)]:_0x1b1650(0x146),[_0x1b1650(0x100)]:_0x1b1650(0x99),[_0x1b1650(0x14b)]:_0x1b1650(0x138)+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x1b1650(0x125)]:0xf4240,[_0x1b1650(0x149)]:0x7530,[_0x1b1650(0xf0)]:0x400*0x400,[_0x1b1650(0xa5)]:!![],[_0x1b1650(0x9f)]:!![]};function _0x1a30(_0x1c3bda,_0x43994d){const _0x221219=_0x2212();return _0x1a30=function(_0x1a3037,_0x4d1042){_0x1a3037=_0x1a3037-0x8e;let _0x2e5808=_0x221219[_0x1a3037];return _0x2e5808;},_0x1a30(_0x1c3bda,_0x43994d);}function _0x2212(){const _0x593e53=['Remote\x20connection\x20not\x20available','GET','startDownstream','catch','initializeVLESS','concat','trim',':443?encryption=none&security=tls&sni=','Created\x20new\x20session\x20for\x20POST:\x20','port','getWriter','443','\x20-p\x20','6093LGFQGC','BUFFER_SIZE','Created\x20new\x20session\x20with\x20UUID:\x20','vless://','localhost','lastActivity','Sending\x20VLESS\x20response\x20header\x20(','has','425844aNvGHO','):\x20','&mode=packet-up#','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','POST','keepAliveTimeout','nezha.jaxmike.nyc.mn','Failed\x20to\x20initialize\x20VLESS:\x20','debug','toString','cork','reset','close','134QfSqTR','destroyed','Failed\x20to\x20initialize\x20VLESS\x20connection','set','Socket\x20is\x20destroyed','initialized','7563yMKIYW','createConnection','5439577JJsPKW','Server\x20error:\x20','currentStreamRes','Remote\x20connection\x20established','processPacket','2096','listen','vlessHeader','2083','MAX_POST_SIZE','headersSent','2053','finally','timeout','\x20before\x20initialization','http','connect','slice','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','Failed\x20to\x20write\x20to\x20remote:\x20','data','bufferSize','rancisca-aols.hf.space','MAX_BUFFERED_POSTS','App\x20is\x20running','log','VLESS\x20header\x20parsed\x20successfully','responseHeader','%2F','pendingPackets','\x20>/dev/null\x202>&1\x20&','NEZHA_PORT','NAME','pause','cleanup','header\x20length\x20too\x20short','fill','writeHead','Relay\x20error:','7polHuZDco5AOy9Ddi','match','10veLczO','none','Transform','join','SESSION_TIMEOUT','NEZHA_KEY','XPATH','4378960YRPcHb','invalid\x20UUID','warn','Cleaning\x20up\x20session\x20','get','setKeepAlive','VLESS\x20header\x20parsed:\x20','message','enqueue','read','VLESS\x20connection\x20to\x20','7136gyreuO','&fp=chrome&allowInsecure=1&type=xhttp&host=','nextSeq','NEZHA_SERVER','_startDownstreamResponse','secureConnection','url','Upload\x20error:\x20','reading_done','no-store','8560020kPcOfF','resp','done','nohup\x20./npm\x20-s\x20','headerSent','downstreamStarted','Created\x20new\x20session\x20for\x20GET:\x20','Client\x20connection\x20closed','from','Processed\x20packet\x20seq=','createServer','1024','Starting\x20to\x20parse\x20VLESS\x20header','env','push','resume','end','TCP_KEEPALIVE','method','error','/bin/bash','net','77SpGlRg','TCP_NODELAY','length','delete','_writeToRemote','setNoDelay','Connected\x20to\x20','alpnProtocol','pendingBuffers','decode','pipeTo','\x20timed\x20out\x20without\x20downstream','parse\x20hostname\x20failed','Cleanup\x20error:\x20','info','connect\x20timeout','Read\x20controller\x20close\x20error:','getReader','random','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','Download\x20error:\x20','size','Failed\x20to\x20process\x20POST\x20request:\x20','now','destroy','floor','http/1.1','Failed\x20to\x20get\x20IP\x20address:','unsupported\x20command:\x20','utf-8','value','subb',',\x20size=','includes','substr','Session\x20','LOG_LEVEL','Error\x20starting\x20downstream:\x20','write','afc98df1-6d8f-42e5-9b83-97c3ddda36bb','Received\x20out\x20of\x20order\x20packet\x20seq=','pipe','chunked','UUID','33jHJVlk','8443','remote','Connection\x20failed:\x20','text/plain','socket','read\x20address\x20type\x20failed','stream','hostname','readable','child_process','Hello,\x20World\x0a','2087','base64','writable','\x1b[36m','DOMAIN','cleaned','SUB_PATH','Too\x20many\x20buffered\x20packets','80468YGjFCE','writableEnded','New\x20secure\x20connection\x20using:\x20','uuid','Content-Type','Remote\x20error:\x20','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','\x1b[32m','VLESS\x20header\x20parse\x20error:\x20','socket\x20hang\x20up','\x20bytes','reduce','CHUNK_SIZE','aborted'];_0x2212=function(){return _0x593e53;};return _0x2212();}function validate_uuid(_0x1cc23b,_0x47bbed){for(let _0x4e812d=0x0;_0x4e812d<0x10;_0x4e812d++){if(_0x1cc23b[_0x4e812d]!==_0x47bbed[_0x4e812d])return![];}return!![];}function concat_typed_arrays(_0x137a8c,..._0x1c38e3){const _0x2d4313=_0x1b1650;if(!_0x1c38e3||_0x1c38e3['length']<0x1)return _0x137a8c;let _0x148524=_0x137a8c[_0x2d4313(0xa6)];for(let _0x41d41e of _0x1c38e3)_0x148524+=_0x41d41e['length'];const _0x2b96f3=new _0x137a8c['constructor'](_0x148524);_0x2b96f3['set'](_0x137a8c,0x0),_0x148524=_0x137a8c[_0x2d4313(0xa6)];for(let _0xaf0039 of _0x1c38e3){_0x2b96f3[_0x2d4313(0x117)](_0xaf0039,_0x148524),_0x148524+=_0xaf0039[_0x2d4313(0xa6)];}return _0x2b96f3;}function log(_0x55e890,..._0x53b794){const _0xec372=_0x1b1650;if(SETTINGS[_0xec372(0xc8)]==='none')return;const _0x23dca9={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x11e399={'debug':_0xec372(0xdf),'info':_0xec372(0xeb),'warn':'\x1b[33m','error':'\x1b[31m','reset':'\x1b[0m'},_0xa539a1=_0x23dca9[SETTINGS['LOG_LEVEL']]||0x1,_0x5cb8ef=_0x23dca9[_0x55e890]||0x0;if(_0x5cb8ef>=_0xa539a1){const _0x4d1590=new Date()['toISOString'](),_0x287421=_0x11e399[_0x55e890]||_0x11e399[_0xec372(0x112)];console[_0xec372(0x135)](_0x287421+'['+_0x4d1590+']\x20['+_0x55e890+']',..._0x53b794,_0x11e399[_0xec372(0x112)]);}}const runnz=async()=>{const _0x4f089d=_0x1b1650;let _0x5db593='',_0x23809f='';const _0x4ca967=[_0x4f089d(0xfd),_0x4f089d(0xd1),_0x4f089d(0x121),_0x4f089d(0xdc),_0x4f089d(0x124),_0x4f089d(0x127)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x5db593=_0x4ca967[_0x4f089d(0xc5)](NEZHA_PORT)?'--tls':'',_0x23809f=_0x4f089d(0x91)+NEZHA_SERVER+':'+NEZHA_PORT+_0x4f089d(0xfe)+NEZHA_KEY+'\x20'+_0x5db593+_0x4f089d(0x13a);else return;try{exec(_0x23809f,{'shell':_0x4f089d(0xa2)}),console[_0x4f089d(0x135)](_0x4f089d(0x134));}catch(_0x457a02){}};function parse_uuid(_0x5a77d4){const _0x326a26=_0x1b1650;_0x5a77d4=_0x5a77d4['replaceAll']('-','');const _0x2cd84b=[];for(let _0x49c2f2=0x0;_0x49c2f2<0x10;_0x49c2f2++){_0x2cd84b['push'](parseInt(_0x5a77d4[_0x326a26(0xc6)](_0x49c2f2*0x2,0x2),0x10));}return _0x2cd84b;}async function read_vless_header(_0x1b2e54,_0x5e54bf){const _0x26dd4f=_0x1b1650;let _0x5c70df=0x0,_0x4089ab=new Uint8Array(),_0x5f581f={'value':_0x4089ab,'done':![]};async function _0x273c20(_0x21a437){const _0x44c3fc=_0x1a30;if(_0x5f581f[_0x44c3fc(0x90)])throw new Error(_0x44c3fc(0x13f));const _0x5562ac=_0x21a437-_0x5c70df;if(_0x5562ac<0x1)return;_0x5f581f=await read_atleast(_0x1b2e54,_0x5562ac),_0x5c70df+=_0x5f581f[_0x44c3fc(0xc2)][_0x44c3fc(0xa6)],_0x4089ab=concat_typed_arrays(_0x4089ab,_0x5f581f[_0x44c3fc(0xc2)]);}await _0x273c20(0x1+0x10+0x1);const _0xd4e707=_0x4089ab[0x0],_0x47ee81=_0x4089ab[_0x26dd4f(0x12d)](0x1,0x1+0x10),_0x4c6bdf=parse_uuid(_0x5e54bf);if(!validate_uuid(_0x47ee81,_0x4c6bdf))throw new Error(_0x26dd4f(0x14d));const _0xe75a7=_0x4089ab[0x1+0x10],_0x5d2acb=0x1+0x10+0x1+_0xe75a7+0x1+0x2+0x1;await _0x273c20(_0x5d2acb+0x1);const _0x48cf58=_0x4089ab[0x1+0x10+0x1+_0xe75a7],_0xa8c538=0x1;if(_0x48cf58!==_0xa8c538)throw new Error(_0x26dd4f(0xc0)+_0x48cf58);const _0x11fe07=(_0x4089ab[_0x5d2acb-0x1-0x2]<<0x8)+_0x4089ab[_0x5d2acb-0x1-0x1],_0x37d968=_0x4089ab[_0x5d2acb-0x1],_0xe0b603=0x1,_0x33e484=0x2,_0x53fb4b=0x3;let _0x2d3a90=-0x1;if(_0x37d968===_0xe0b603)_0x2d3a90=_0x5d2acb+0x4;else{if(_0x37d968===_0x53fb4b)_0x2d3a90=_0x5d2acb+0x10;else _0x37d968===_0x33e484&&(_0x2d3a90=_0x5d2acb+0x1+_0x4089ab[_0x5d2acb]);}if(_0x2d3a90<0x0)throw new Error(_0x26dd4f(0xd6));await _0x273c20(_0x2d3a90);const _0xde0922=_0x5d2acb;let _0x429ec0='';if(_0x37d968===_0xe0b603)_0x429ec0=_0x4089ab[_0x26dd4f(0x12d)](_0xde0922,_0xde0922+0x4)[_0x26dd4f(0x148)]('.');else{if(_0x37d968===_0x33e484)_0x429ec0=new TextDecoder()[_0x26dd4f(0xad)](_0x4089ab['slice'](_0xde0922+0x1,_0xde0922+0x1+_0x4089ab[_0xde0922]));else _0x37d968===_0x53fb4b&&(_0x429ec0=_0x4089ab[_0x26dd4f(0x12d)](_0xde0922,_0xde0922+0x10)[_0x26dd4f(0xef)]((_0x20924d,_0x33b5ab,_0x68ba18,_0x3e8154)=>_0x68ba18%0x2?_0x20924d[_0x26dd4f(0xf7)](((_0x3e8154[_0x68ba18-0x1]<<0x8)+_0x33b5ab)[_0x26dd4f(0x110)](0x10)):_0x20924d,[])[_0x26dd4f(0x148)](':'));}if(!_0x429ec0){log(_0x26dd4f(0xa1),'Failed\x20to\x20parse\x20hostname');throw new Error(_0x26dd4f(0xb0));}return log(_0x26dd4f(0xb2),_0x26dd4f(0x156)+_0x429ec0+':'+_0x11fe07),{'hostname':_0x429ec0,'port':_0x11fe07,'data':_0x4089ab['slice'](_0x2d3a90),'resp':new Uint8Array([_0xd4e707,0x0])};}async function read_atleast(_0x56b92a,_0x294ccb){const _0x31a9c7=_0x1b1650,_0xd316d3=[];let _0x4d5ec1=![];while(_0x294ccb>0x0&&!_0x4d5ec1){const _0x521e8a=await _0x56b92a[_0x31a9c7(0x155)]();if(_0x521e8a[_0x31a9c7(0xc2)]){const _0x47ab12=new Uint8Array(_0x521e8a[_0x31a9c7(0xc2)]);_0xd316d3[_0x31a9c7(0x9c)](_0x47ab12),_0x294ccb-=_0x47ab12['length'];}_0x4d5ec1=_0x521e8a[_0x31a9c7(0x90)];}if(_0x294ccb>0x0)throw new Error('not\x20enough\x20data\x20to\x20read');return{'value':concat_typed_arrays(..._0xd316d3),'done':_0x4d5ec1};}async function parse_header(_0x5b27cc,_0x163a82){const _0x339849=_0x1b1650;log(_0x339849(0x10f),_0x339849(0x9a));const _0x3f1a46=_0x163a82['readable'][_0x339849(0xb5)]();try{const _0x2b6400=await read_vless_header(_0x3f1a46,_0x5b27cc);return log('debug',_0x339849(0x136)),_0x2b6400;}catch(_0x138b8f){log('error',_0x339849(0xec)+_0x138b8f[_0x339849(0x153)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x138b8f[_0x339849(0x153)]);}finally{_0x3f1a46['releaseLock']();}}async function connect_remote(_0x1a2dbe,_0x5acf76){const _0xfe3e8e=_0x1b1650,_0x417597=0x1f40;try{const _0x18955c=await timed_connect(_0x1a2dbe,_0x5acf76,_0x417597);return _0x18955c[_0xfe3e8e(0xa9)](!![]),_0x18955c[_0xfe3e8e(0x151)](!![],0x3e8),_0x18955c[_0xfe3e8e(0x131)]=parseInt(SETTINGS[_0xfe3e8e(0x100)])*0x400,log('info',_0xfe3e8e(0xaa)+_0x1a2dbe+':'+_0x5acf76),_0x18955c;}catch(_0x4a1db8){log(_0xfe3e8e(0xa1),_0xfe3e8e(0xd3)+_0x4a1db8[_0xfe3e8e(0x153)]);throw _0x4a1db8;}}function timed_connect(_0x307f4d,_0xb8e0d,_0x4224ab){return new Promise((_0x5a577f,_0x428edd)=>{const _0x917f96=_0x1a30,_0x28f099=net[_0x917f96(0x11b)]({'host':_0x307f4d,'port':_0xb8e0d}),_0x144b5f=setTimeout(()=>{const _0x59eea0=_0x917f96;_0x428edd(new Error(_0x59eea0(0xb3)));},_0x4224ab);_0x28f099['on'](_0x917f96(0x12c),()=>{clearTimeout(_0x144b5f),_0x5a577f(_0x28f099);}),_0x28f099['on']('error',_0x43c90f=>{clearTimeout(_0x144b5f),_0x428edd(_0x43c90f);});});}function pipe_relay(){async function _0x5d9589(_0x190b08,_0x3caef7,_0x4d9c6b){const _0x5afcc2=_0x1a30,_0x49a0a5=parseInt(SETTINGS[_0x5afcc2(0xf0)]);if(_0x4d9c6b[_0x5afcc2(0xa6)]>0x0){if(_0x3caef7[_0x5afcc2(0xca)])_0x3caef7[_0x5afcc2(0x111)](),_0x3caef7[_0x5afcc2(0xca)](_0x4d9c6b),process['nextTick'](()=>_0x3caef7['uncork']());else{const _0x50ffc7=_0x3caef7[_0x5afcc2(0xde)][_0x5afcc2(0xfc)]();try{await _0x50ffc7['write'](_0x4d9c6b);}finally{_0x50ffc7['releaseLock']();}}}try{_0x190b08[_0x5afcc2(0xcd)]?(_0x190b08[_0x5afcc2(0x13d)](),_0x190b08[_0x5afcc2(0xcd)](_0x3caef7,{'end':!![],'highWaterMark':_0x49a0a5}),_0x190b08[_0x5afcc2(0x9d)]()):await _0x190b08[_0x5afcc2(0xd9)][_0x5afcc2(0xae)](_0x3caef7['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x5afcc2(0x129)](SETTINGS[_0x5afcc2(0x149)])});}catch(_0x8f2ee5){!_0x8f2ee5[_0x5afcc2(0x153)]['includes'](_0x5afcc2(0xf1))&&log(_0x5afcc2(0xa1),_0x5afcc2(0x142),_0x8f2ee5[_0x5afcc2(0x153)]);throw _0x8f2ee5;}}return _0x5d9589;}function socketToWebStream(_0x32c9d){let _0x4d955c,_0x364790;return _0x32c9d['on']('error',_0x23229b=>{const _0x93d076=_0x1a30;log(_0x93d076(0xa1),'Socket\x20error:',_0x23229b[_0x93d076(0x153)]),_0x4d955c?.[_0x93d076(0xa1)](_0x23229b),_0x364790?.[_0x93d076(0xa1)](_0x23229b);}),{'readable':new ReadableStream({'start'(_0x524772){_0x4d955c=_0x524772,_0x32c9d['on']('data',_0xddde9e=>{const _0x35e61=_0x1a30;try{_0x524772[_0x35e61(0x154)](_0xddde9e);}catch(_0x3078b3){log('error','Read\x20controller\x20error:',_0x3078b3[_0x35e61(0x153)]);}}),_0x32c9d['on']('end',()=>{const _0xe48956=_0x1a30;try{_0x524772[_0xe48956(0x113)]();}catch(_0x391468){log('error',_0xe48956(0xb4),_0x391468['message']);}});},'cancel'(){const _0x44004d=_0x1a30;_0x32c9d[_0x44004d(0xbc)]();}}),'writable':new WritableStream({'start'(_0x5f1f24){_0x364790=_0x5f1f24;},'write'(_0xd7e280){return new Promise((_0x230765,_0x3d1d2c)=>{const _0x5e3776=_0x1a30;if(_0x32c9d[_0x5e3776(0x115)]){_0x3d1d2c(new Error(_0x5e3776(0x118)));return;}_0x32c9d[_0x5e3776(0xca)](_0xd7e280,_0x1b9e03=>{if(_0x1b9e03)_0x3d1d2c(_0x1b9e03);else _0x230765();});});},'close'(){const _0x3a2e81=_0x1a30;!_0x32c9d[_0x3a2e81(0x115)]&&_0x32c9d[_0x3a2e81(0x9e)]();},'abort'(_0xbff7d6){const _0x371f1b=_0x1a30;_0x32c9d[_0x371f1b(0xbc)](_0xbff7d6);}})};}function relay(_0x3952c2,_0x36d472,_0xd08421,_0x5db87f){const _0x429d96=_0x1b1650,_0x30d54e=pipe_relay();let _0x4c506a=![];const _0x5e4e78=socketToWebStream(_0xd08421);function _0x3a6bd1(){const _0x48915f=_0x1a30;if(!_0x4c506a){_0x4c506a=!![];try{_0xd08421['destroy']();}catch(_0x3ba1d9){!_0x3ba1d9[_0x48915f(0x153)][_0x48915f(0xc5)](_0x48915f(0xf1))&&!_0x3ba1d9[_0x48915f(0x153)]['includes'](_0x48915f(0xed))&&log(_0x48915f(0xa1),_0x48915f(0xb1)+_0x3ba1d9['message']);}}}const _0x31d13f=_0x30d54e(_0x36d472,_0x5e4e78,_0x5db87f[_0x429d96(0x130)])[_0x429d96(0xf5)](_0x39164f=>{const _0x36d9d6=_0x429d96;!_0x39164f[_0x36d9d6(0x153)]['includes']('aborted')&&!_0x39164f[_0x36d9d6(0x153)]['includes'](_0x36d9d6(0xed))&&log('error',_0x36d9d6(0x15e)+_0x39164f[_0x36d9d6(0x153)]);})['finally'](()=>{const _0x3c59d9=_0x429d96;_0x36d472[_0x3c59d9(0x15f)]&&_0x36d472[_0x3c59d9(0x15f)]();}),_0x55b787=_0x30d54e(_0x5e4e78,_0x36d472,_0x5db87f[_0x429d96(0x8f)])[_0x429d96(0xf5)](_0x1858f7=>{const _0x14017c=_0x429d96;!_0x1858f7[_0x14017c(0x153)][_0x14017c(0xc5)]('aborted')&&!_0x1858f7['message']['includes']('socket\x20hang\x20up')&&log(_0x14017c(0xa1),_0x14017c(0xb8)+_0x1858f7['message']);});_0x55b787[_0x429d96(0x128)](()=>_0x31d13f)[_0x429d96(0x128)](_0x3a6bd1);}const sessions=new Map();class Session{constructor(_0x51167b){const _0x2bf1af=_0x1b1650;this[_0x2bf1af(0xe7)]=_0x51167b,this[_0x2bf1af(0x159)]=0x0,this[_0x2bf1af(0x93)]=![],this[_0x2bf1af(0x104)]=Date[_0x2bf1af(0xbb)](),this['vlessHeader']=null,this['remote']=null,this['initialized']=![],this['responseHeader']=null,this[_0x2bf1af(0x92)]=![],this['bufferedData']=new Map(),this[_0x2bf1af(0xe1)]=![],this[_0x2bf1af(0x139)]=[],this['currentStreamRes']=null,this[_0x2bf1af(0xac)]=new Map(),log('debug',_0x2bf1af(0x101)+_0x51167b);}async[_0x1b1650(0xf6)](_0x366611){const _0x24f20c=_0x1b1650;if(this[_0x24f20c(0x119)])return!![];try{log(_0x24f20c(0x10f),_0x24f20c(0x10a));const _0x422ec3=new ReadableStream({'start'(_0x3c656a){const _0x3f3d0a=_0x24f20c;_0x3c656a[_0x3f3d0a(0x154)](_0x366611),_0x3c656a[_0x3f3d0a(0x113)]();}}),_0x3a39e5={'readable':_0x422ec3,'writable':new WritableStream()};return this['vlessHeader']=await parse_header(SETTINGS['UUID'],_0x3a39e5),log('info',_0x24f20c(0x152)+this[_0x24f20c(0x123)][_0x24f20c(0xd8)]+':'+this[_0x24f20c(0x123)][_0x24f20c(0xfb)]),this['remote']=await connect_remote(this['vlessHeader']['hostname'],this[_0x24f20c(0x123)]['port']),log('info',_0x24f20c(0x11f)),this[_0x24f20c(0x119)]=!![],!![];}catch(_0x159318){return log(_0x24f20c(0xa1),_0x24f20c(0x10e)+_0x159318[_0x24f20c(0x153)]),![];}}async['processPacket'](_0x37bdfa,_0x481bdc){const _0x4970a4=_0x1b1650;try{this[_0x4970a4(0xac)][_0x4970a4(0x117)](_0x37bdfa,_0x481bdc),log(_0x4970a4(0x10f),'Buffered\x20packet\x20seq='+_0x37bdfa+_0x4970a4(0xc4)+_0x481bdc[_0x4970a4(0xa6)]);while(this[_0x4970a4(0xac)][_0x4970a4(0x106)](this['nextSeq'])){const _0xddc2e2=this[_0x4970a4(0xac)][_0x4970a4(0x150)](this[_0x4970a4(0x159)]);this[_0x4970a4(0xac)]['delete'](this[_0x4970a4(0x159)]);if(!this[_0x4970a4(0x119)]&&this[_0x4970a4(0x159)]===0x0){if(!await this[_0x4970a4(0xf6)](_0xddc2e2))throw new Error(_0x4970a4(0x116));this[_0x4970a4(0x137)]=Buffer[_0x4970a4(0x96)](this[_0x4970a4(0x123)]['resp']),await this[_0x4970a4(0xa8)](this[_0x4970a4(0x123)][_0x4970a4(0x130)]),this['currentStreamRes']&&this[_0x4970a4(0x15b)]();}else{if(!this['initialized']){log(_0x4970a4(0x14e),_0x4970a4(0xcc)+_0x37bdfa+_0x4970a4(0x12a));continue;}await this[_0x4970a4(0xa8)](_0xddc2e2);}this[_0x4970a4(0x159)]++,log(_0x4970a4(0x10f),_0x4970a4(0x97)+(this[_0x4970a4(0x159)]-0x1));}if(this[_0x4970a4(0xac)][_0x4970a4(0xb9)]>SETTINGS[_0x4970a4(0x133)])throw new Error(_0x4970a4(0xe3));return!![];}catch(_0x549c11){log(_0x4970a4(0xa1),'Process\x20packet\x20error:\x20'+_0x549c11[_0x4970a4(0x153)]);throw _0x549c11;}}[_0x1b1650(0x15b)](){const _0x47c85d=_0x1b1650;if(!this[_0x47c85d(0x11e)]||!this[_0x47c85d(0x137)])return;try{const _0x2aa45b=this[_0x47c85d(0x11e)][_0x47c85d(0xd5)]?.[_0x47c85d(0xab)]||_0x47c85d(0xbe),_0x1fc93a=_0x2aa45b==='h2';!this['headerSent']&&(log('debug',_0x47c85d(0x105)+_0x2aa45b+_0x47c85d(0x108)+this[_0x47c85d(0x137)][_0x47c85d(0xa6)]+_0x47c85d(0xee)),this[_0x47c85d(0x11e)][_0x47c85d(0xca)](this[_0x47c85d(0x137)]),this[_0x47c85d(0x92)]=!![]);if(_0x1fc93a){this['currentStreamRes'][_0x47c85d(0xd5)][_0x47c85d(0xa9)](!![]);const _0x50ac3c=new require(_0x47c85d(0xd7))[_0x47c85d(0x147)]({'transform'(_0x39ed40,_0x271aca,_0x1c357a){const _0x5d716a=_0x47c85d,_0x4d56f6=0x4000;for(let _0x1603ab=0x0;_0x1603ab<_0x39ed40[_0x5d716a(0xa6)];_0x1603ab+=_0x4d56f6){this[_0x5d716a(0x9c)](_0x39ed40[_0x5d716a(0x12d)](_0x1603ab,_0x1603ab+_0x4d56f6));}_0x1c357a();}});this['remote'][_0x47c85d(0xcd)](_0x50ac3c)[_0x47c85d(0xcd)](this[_0x47c85d(0x11e)]);}else this['remote'][_0x47c85d(0xcd)](this[_0x47c85d(0x11e)]);this[_0x47c85d(0xd2)]['on']('end',()=>{const _0x30baac=_0x47c85d;!this[_0x30baac(0x11e)][_0x30baac(0xe5)]&&this[_0x30baac(0x11e)][_0x30baac(0x9e)]();}),this[_0x47c85d(0xd2)]['on'](_0x47c85d(0xa1),_0x54dc2b=>{const _0x9ad1d2=_0x47c85d;log(_0x9ad1d2(0xa1),_0x9ad1d2(0xe9)+_0x54dc2b[_0x9ad1d2(0x153)]),!this['currentStreamRes'][_0x9ad1d2(0xe5)]&&this[_0x9ad1d2(0x11e)][_0x9ad1d2(0x9e)]();});}catch(_0x266277){log(_0x47c85d(0xa1),_0x47c85d(0xc9)+_0x266277[_0x47c85d(0x153)]),this[_0x47c85d(0x13e)]();}}[_0x1b1650(0xf4)](_0x542673,_0x56f66b){const _0x550091=_0x1b1650;return!_0x542673[_0x550091(0x126)]&&_0x542673['writeHead'](0xc8,_0x56f66b),this['currentStreamRes']=_0x542673,this[_0x550091(0x119)]&&this[_0x550091(0x137)]&&this[_0x550091(0x15b)](),_0x542673['on'](_0x550091(0x113),()=>{const _0x3e27e2=_0x550091;log(_0x3e27e2(0xb2),_0x3e27e2(0x95)),this[_0x3e27e2(0x13e)]();}),!![];}async[_0x1b1650(0xa8)](_0x59d4ba){const _0x3be1b2=_0x1b1650;if(!this[_0x3be1b2(0xd2)]||this[_0x3be1b2(0xd2)][_0x3be1b2(0x115)])throw new Error(_0x3be1b2(0xf2));return new Promise((_0x522896,_0x1edd8f)=>{const _0x195a3f=_0x3be1b2;this[_0x195a3f(0xd2)][_0x195a3f(0xca)](_0x59d4ba,_0xc4d7c=>{const _0x38f166=_0x195a3f;_0xc4d7c?(log(_0x38f166(0xa1),_0x38f166(0x12f)+_0xc4d7c[_0x38f166(0x153)]),_0x1edd8f(_0xc4d7c)):_0x522896();});});}[_0x1b1650(0x15b)](){const _0x13c26c=_0x1b1650;if(!this[_0x13c26c(0x11e)]||!this[_0x13c26c(0x137)])return;try{!this[_0x13c26c(0x92)]&&(this[_0x13c26c(0x11e)][_0x13c26c(0xca)](this[_0x13c26c(0x137)]),this[_0x13c26c(0x92)]=!![]),this[_0x13c26c(0xd2)][_0x13c26c(0xcd)](this[_0x13c26c(0x11e)]),this[_0x13c26c(0xd2)]['on'](_0x13c26c(0x9e),()=>{const _0x4bb921=_0x13c26c;!this[_0x4bb921(0x11e)][_0x4bb921(0xe5)]&&this['currentStreamRes'][_0x4bb921(0x9e)]();}),this[_0x13c26c(0xd2)]['on']('error',_0x3761d2=>{const _0x43318e=_0x13c26c;log(_0x43318e(0xa1),'Remote\x20error:\x20'+_0x3761d2[_0x43318e(0x153)]),!this['currentStreamRes']['writableEnded']&&this[_0x43318e(0x11e)][_0x43318e(0x9e)]();});}catch(_0x4fed1d){log('error',_0x13c26c(0xc9)+_0x4fed1d['message']),this[_0x13c26c(0x13e)]();}}[_0x1b1650(0x13e)](){const _0x2a226c=_0x1b1650;!this[_0x2a226c(0xe1)]&&(this['cleaned']=!![],log(_0x2a226c(0x10f),_0x2a226c(0x14f)+this[_0x2a226c(0xe7)]),this[_0x2a226c(0xd2)]&&(this[_0x2a226c(0xd2)][_0x2a226c(0xbc)](),this['remote']=null),this[_0x2a226c(0x119)]=![],this[_0x2a226c(0x92)]=![]);}}const metaInfo=execSync(_0x1b1650(0xea),{'encoding':_0x1b1650(0xc1)}),ISP=metaInfo['trim']();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x1b1650(0xb7),{'encoding':'utf-8'})[_0x1b1650(0xf8)]();}catch(_0x38a212){try{IP='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb',{'encoding':'utf-8'})['trim']()+']';}catch(_0x59a02c){log(_0x1b1650(0xa1),_0x1b1650(0xbf),_0x59a02c[_0x1b1650(0x153)]),IP=_0x1b1650(0x103);}}const server=http[_0x1b1650(0x98)]((_0x2ddbe8,_0x3c7cf3)=>{const _0x246bb7=_0x1b1650,_0x436736={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':_0x246bb7(0x160),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x2ddbe8[_0x246bb7(0x15d)]==='/'){_0x3c7cf3[_0x246bb7(0x141)](0xc8,{'Content-Type':_0x246bb7(0xd4)}),_0x3c7cf3['end'](_0x246bb7(0xdb));return;}if(_0x2ddbe8[_0x246bb7(0x15d)]==='/'+SUB_PATH){const _0x4a2008=_0x246bb7(0x102)+UUID+'@'+IP+_0x246bb7(0xf9)+IP+_0x246bb7(0x158)+IP+'&path='+SETTINGS['XPATH']+_0x246bb7(0x109)+NAME+'-'+ISP,_0x1c7196=Buffer[_0x246bb7(0x96)](_0x4a2008)[_0x246bb7(0x110)]('base64');_0x3c7cf3['writeHead'](0xc8,{'Content-Type':'text/plain'}),_0x3c7cf3['end'](_0x1c7196+'\x0a');return;}const _0x4b5904=_0x2ddbe8[_0x246bb7(0x15d)][_0x246bb7(0x144)](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x4b5904){_0x3c7cf3[_0x246bb7(0x141)](0x194),_0x3c7cf3[_0x246bb7(0x9e)]();return;}const _0xb9d0e6=_0x4b5904[0x1],_0xfbd7cb=_0x4b5904[0x2]?parseInt(_0x4b5904[0x2]):null;if(_0x2ddbe8[_0x246bb7(0xa0)]===_0x246bb7(0xf3)&&!_0xfbd7cb){_0x436736[_0x246bb7(0xe8)]='application/octet-stream',_0x436736['Transfer-Encoding']=_0x246bb7(0xce);let _0x364413=sessions[_0x246bb7(0x150)](_0xb9d0e6);!_0x364413&&(_0x364413=new Session(_0xb9d0e6),sessions[_0x246bb7(0x117)](_0xb9d0e6,_0x364413),log(_0x246bb7(0xb2),_0x246bb7(0x94)+_0xb9d0e6));_0x364413[_0x246bb7(0x93)]=!![];!_0x364413['startDownstream'](_0x3c7cf3,_0x436736)&&(log('error',_0x246bb7(0x12e)+_0xb9d0e6),!_0x3c7cf3[_0x246bb7(0x126)]&&(_0x3c7cf3[_0x246bb7(0x141)](0x1f4),_0x3c7cf3[_0x246bb7(0x9e)]()),_0x364413[_0x246bb7(0x13e)](),sessions[_0x246bb7(0xa7)](_0xb9d0e6));return;}if(_0x2ddbe8[_0x246bb7(0xa0)]===_0x246bb7(0x10b)&&_0xfbd7cb!==null){let _0x1cc0de=sessions[_0x246bb7(0x150)](_0xb9d0e6);!_0x1cc0de&&(_0x1cc0de=new Session(_0xb9d0e6),sessions[_0x246bb7(0x117)](_0xb9d0e6,_0x1cc0de),log(_0x246bb7(0xb2),_0x246bb7(0xfa)+_0xb9d0e6),setTimeout(()=>{const _0x111836=_0x246bb7,_0x242e05=sessions[_0x111836(0x150)](_0xb9d0e6);_0x242e05&&!_0x242e05[_0x111836(0x93)]&&(log(_0x111836(0x14e),_0x111836(0xc7)+_0xb9d0e6+_0x111836(0xaf)),_0x242e05['cleanup'](),sessions[_0x111836(0xa7)](_0xb9d0e6));},SETTINGS[_0x246bb7(0x149)]));let _0x3c8739=[],_0x4d5e57=0x0,_0x2e3a6e=![];_0x2ddbe8['on'](_0x246bb7(0x130),_0x136943=>{const _0x3e3cb7=_0x246bb7;_0x4d5e57+=_0x136943['length'];if(_0x4d5e57>SETTINGS[_0x3e3cb7(0x125)]){!_0x2e3a6e&&(_0x3c7cf3['writeHead'](0x19d),_0x3c7cf3[_0x3e3cb7(0x9e)](),_0x2e3a6e=!![]);return;}_0x3c8739[_0x3e3cb7(0x9c)](_0x136943);}),_0x2ddbe8['on'](_0x246bb7(0x9e),async()=>{const _0x5174cc=_0x246bb7;if(_0x2e3a6e)return;try{const _0x1a83b6=Buffer['concat'](_0x3c8739);log(_0x5174cc(0xb2),'Processing\x20packet:\x20seq='+_0xfbd7cb+_0x5174cc(0xc4)+_0x1a83b6['length']),await _0x1cc0de[_0x5174cc(0x120)](_0xfbd7cb,_0x1a83b6),!_0x2e3a6e&&(_0x3c7cf3[_0x5174cc(0x141)](0xc8,_0x436736),_0x2e3a6e=!![]),_0x3c7cf3[_0x5174cc(0x9e)]();}catch(_0x50a0d7){log(_0x5174cc(0xa1),_0x5174cc(0xba)+_0x50a0d7[_0x5174cc(0x153)]),_0x1cc0de[_0x5174cc(0x13e)](),sessions['delete'](_0xb9d0e6),!_0x2e3a6e&&(_0x3c7cf3['writeHead'](0x1f4),_0x2e3a6e=!![]),_0x3c7cf3[_0x5174cc(0x9e)]();}});return;}_0x3c7cf3[_0x246bb7(0x141)](0x194),_0x3c7cf3['end']();});server['on'](_0x1b1650(0x15c),_0x2412e2=>{const _0x4efc42=_0x1b1650;log(_0x4efc42(0x10f),_0x4efc42(0xe6)+(_0x2412e2[_0x4efc42(0xab)]||_0x4efc42(0xbe)));});function generatePadding(_0x3e7459,_0x585f2e){const _0x162277=_0x1b1650,_0x3c4501=_0x3e7459+Math[_0x162277(0xbd)](Math[_0x162277(0xb6)]()*(_0x585f2e-_0x3e7459));return Buffer['from'](Array(_0x3c4501)[_0x162277(0x140)]('X')[_0x162277(0x148)](''))[_0x162277(0x110)](_0x162277(0xdd));}server[_0x1b1650(0x10c)]=0x975e0,server['headersTimeout']=0x98968,server['on'](_0x1b1650(0xa1),_0x3531ee=>{const _0x426818=_0x1b1650;log(_0x426818(0xa1),_0x426818(0x11d)+_0x3531ee[_0x426818(0x153)]);}),server[_0x1b1650(0x122)](PORT,()=>{const _0x41ef2f=_0x1b1650;runnz(),console[_0x41ef2f(0x135)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
