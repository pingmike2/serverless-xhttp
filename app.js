const _0x1813ef=_0x3066;(function(_0x182d6c,_0x1760e9){const _0x541cc8=_0x3066,_0x178283=_0x182d6c();while(!![]){try{const _0x3a64f6=parseInt(_0x541cc8(0xb0))/0x1*(-parseInt(_0x541cc8(0xec))/0x2)+parseInt(_0x541cc8(0xb2))/0x3*(parseInt(_0x541cc8(0x13d))/0x4)+-parseInt(_0x541cc8(0x11a))/0x5+-parseInt(_0x541cc8(0x113))/0x6*(parseInt(_0x541cc8(0x129))/0x7)+parseInt(_0x541cc8(0xf0))/0x8*(parseInt(_0x541cc8(0xfa))/0x9)+parseInt(_0x541cc8(0xb9))/0xa*(parseInt(_0x541cc8(0x104))/0xb)+-parseInt(_0x541cc8(0x139))/0xc;if(_0x3a64f6===_0x1760e9)break;else _0x178283['push'](_0x178283['shift']());}catch(_0x1c8697){_0x178283['push'](_0x178283['shift']());}}}(_0x292e,0x8b711));const net=require('net'),http=require(_0x1813ef(0x136)),{Buffer}=require(_0x1813ef(0xb3)),{exec,execSync}=require(_0x1813ef(0x103)),UUID=process[_0x1813ef(0x111)]['UUID']||_0x1813ef(0x127),NEZHA_SERVER=process[_0x1813ef(0x111)][_0x1813ef(0x107)]||'nezha.jaxmike.nyc.mn',NEZHA_PORT=process[_0x1813ef(0x111)][_0x1813ef(0x11c)]||_0x1813ef(0x14e),NEZHA_KEY=process[_0x1813ef(0x111)][_0x1813ef(0x109)]||_0x1813ef(0x11d),SUB_PATH=process[_0x1813ef(0x111)][_0x1813ef(0x108)]||_0x1813ef(0xce),XPATH=process[_0x1813ef(0x111)][_0x1813ef(0xbb)]||UUID[_0x1813ef(0x123)](0x0,0x8),DOMAIN=process['env'][_0x1813ef(0xc3)]||'rancisca-aols.hf.space',NAME=process[_0x1813ef(0x111)][_0x1813ef(0xdf)]||'Hf',PORT=process[_0x1813ef(0x111)]['PORT']||0x1eb4,SETTINGS={['UUID']:UUID,[_0x1813ef(0x151)]:'none',[_0x1813ef(0xd5)]:'1024',[_0x1813ef(0xbb)]:_0x1813ef(0xa1)+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x1813ef(0x99)]:0xf4240,[_0x1813ef(0x157)]:0x7530,[_0x1813ef(0xb1)]:0x400*0x400,['TCP_NODELAY']:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x26f4a2,_0x488c30){for(let _0x312c28=0x0;_0x312c28<0x10;_0x312c28++){if(_0x26f4a2[_0x312c28]!==_0x488c30[_0x312c28])return![];}return!![];}function concat_typed_arrays(_0x569427,..._0x396236){const _0x215ead=_0x1813ef;if(!_0x396236||_0x396236['length']<0x1)return _0x569427;let _0x52fd2b=_0x569427[_0x215ead(0x105)];for(let _0x24aa86 of _0x396236)_0x52fd2b+=_0x24aa86[_0x215ead(0x105)];const _0xe0cf26=new _0x569427[(_0x215ead(0x114))](_0x52fd2b);_0xe0cf26['set'](_0x569427,0x0),_0x52fd2b=_0x569427[_0x215ead(0x105)];for(let _0x23d107 of _0x396236){_0xe0cf26['set'](_0x23d107,_0x52fd2b),_0x52fd2b+=_0x23d107[_0x215ead(0x105)];}return _0xe0cf26;}function log(_0x452c39,..._0x38a716){const _0x110ed3=_0x1813ef;if(SETTINGS[_0x110ed3(0x151)]==='none')return;const _0x1d7b1b={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x16abb2={'debug':'\x1b[36m','info':_0x110ed3(0x141),'warn':'\x1b[33m','error':'\x1b[31m','reset':'\x1b[0m'},_0x5ebb8d=_0x1d7b1b[SETTINGS[_0x110ed3(0x151)]]||0x1,_0x569a68=_0x1d7b1b[_0x452c39]||0x0;if(_0x569a68>=_0x5ebb8d){const _0x2bc1b0=new Date()[_0x110ed3(0xc5)](),_0x4ae863=_0x16abb2[_0x452c39]||_0x16abb2[_0x110ed3(0x10d)];console[_0x110ed3(0xf1)](_0x4ae863+'['+_0x2bc1b0+_0x110ed3(0x134)+_0x452c39+']',..._0x38a716,_0x16abb2['reset']);}}const runnz=async()=>{const _0x6fdee5=_0x1813ef;let _0x1f3c58='',_0x197457='';const _0x3c0221=[_0x6fdee5(0x14e),'8443','2096',_0x6fdee5(0x132),_0x6fdee5(0xc4),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x1f3c58=_0x3c0221['includes'](NEZHA_PORT)?_0x6fdee5(0x14a):'',_0x197457=_0x6fdee5(0x146)+NEZHA_SERVER+':'+NEZHA_PORT+_0x6fdee5(0x13a)+NEZHA_KEY+'\x20'+_0x1f3c58+_0x6fdee5(0xd4);else return;try{exec(_0x197457,{'shell':_0x6fdee5(0x149)}),console[_0x6fdee5(0xf1)]('App\x20is\x20running');}catch(_0x4bda58){}};function parse_uuid(_0x15ba96){const _0x22dc4d=_0x1813ef;_0x15ba96=_0x15ba96['replaceAll']('-','');const _0x2764ac=[];for(let _0x476898=0x0;_0x476898<0x10;_0x476898++){_0x2764ac['push'](parseInt(_0x15ba96[_0x22dc4d(0x96)](_0x476898*0x2,0x2),0x10));}return _0x2764ac;}function _0x3066(_0x4abd66,_0x35191d){const _0x292ee5=_0x292e();return _0x3066=function(_0x3066f9,_0x20d6e5){_0x3066f9=_0x3066f9-0x95;let _0xa20b26=_0x292ee5[_0x3066f9];return _0xa20b26;},_0x3066(_0x4abd66,_0x35191d);}async function read_vless_header(_0xd49723,_0x4ce3ca){const _0x4c002a=_0x1813ef;let _0x12052b=0x0,_0x4882af=new Uint8Array(),_0x58bafc={'value':_0x4882af,'done':![]};async function _0x22d8f9(_0x39d504){const _0x154551=_0x3066;if(_0x58bafc[_0x154551(0xff)])throw new Error(_0x154551(0xb4));const _0x2c458c=_0x39d504-_0x12052b;if(_0x2c458c<0x1)return;_0x58bafc=await read_atleast(_0xd49723,_0x2c458c),_0x12052b+=_0x58bafc['value'][_0x154551(0x105)],_0x4882af=concat_typed_arrays(_0x4882af,_0x58bafc[_0x154551(0x12c)]);}await _0x22d8f9(0x1+0x10+0x1);const _0x1e52a1=_0x4882af[0x0],_0xd9d5f3=_0x4882af[_0x4c002a(0x123)](0x1,0x1+0x10),_0x42037a=parse_uuid(_0x4ce3ca);if(!validate_uuid(_0xd9d5f3,_0x42037a))throw new Error('invalid\x20UUID');const _0x4337fe=_0x4882af[0x1+0x10],_0x1154d2=0x1+0x10+0x1+_0x4337fe+0x1+0x2+0x1;await _0x22d8f9(_0x1154d2+0x1);const _0x22b540=_0x4882af[0x1+0x10+0x1+_0x4337fe],_0x5b9986=0x1;if(_0x22b540!==_0x5b9986)throw new Error(_0x4c002a(0x102)+_0x22b540);const _0x42d28e=(_0x4882af[_0x1154d2-0x1-0x2]<<0x8)+_0x4882af[_0x1154d2-0x1-0x1],_0x19dc09=_0x4882af[_0x1154d2-0x1],_0x500400=0x1,_0x4889ef=0x2,_0x56936b=0x3;let _0x222fa6=-0x1;if(_0x19dc09===_0x500400)_0x222fa6=_0x1154d2+0x4;else{if(_0x19dc09===_0x56936b)_0x222fa6=_0x1154d2+0x10;else _0x19dc09===_0x4889ef&&(_0x222fa6=_0x1154d2+0x1+_0x4882af[_0x1154d2]);}if(_0x222fa6<0x0)throw new Error(_0x4c002a(0xa9));await _0x22d8f9(_0x222fa6);const _0x24ec26=_0x1154d2;let _0x589403='';if(_0x19dc09===_0x500400)_0x589403=_0x4882af['slice'](_0x24ec26,_0x24ec26+0x4)[_0x4c002a(0xeb)]('.');else{if(_0x19dc09===_0x4889ef)_0x589403=new TextDecoder()[_0x4c002a(0x143)](_0x4882af['slice'](_0x24ec26+0x1,_0x24ec26+0x1+_0x4882af[_0x24ec26]));else _0x19dc09===_0x56936b&&(_0x589403=_0x4882af['slice'](_0x24ec26,_0x24ec26+0x10)[_0x4c002a(0x135)]((_0x577fda,_0x203cd2,_0x432a19,_0xab14a)=>_0x432a19%0x2?_0x577fda[_0x4c002a(0x10f)](((_0xab14a[_0x432a19-0x1]<<0x8)+_0x203cd2)[_0x4c002a(0xab)](0x10)):_0x577fda,[])[_0x4c002a(0xeb)](':'));}if(!_0x589403){log(_0x4c002a(0xaa),_0x4c002a(0xea));throw new Error(_0x4c002a(0xe7));}return log('info',_0x4c002a(0xf8)+_0x589403+':'+_0x42d28e),{'hostname':_0x589403,'port':_0x42d28e,'data':_0x4882af['slice'](_0x222fa6),'resp':new Uint8Array([_0x1e52a1,0x0])};}async function read_atleast(_0x35b2d1,_0x2ac5b3){const _0x283df7=_0x1813ef,_0x1bf619=[];let _0x3940eb=![];while(_0x2ac5b3>0x0&&!_0x3940eb){const _0x29a571=await _0x35b2d1['read']();if(_0x29a571[_0x283df7(0x12c)]){const _0x406fd2=new Uint8Array(_0x29a571[_0x283df7(0x12c)]);_0x1bf619['push'](_0x406fd2),_0x2ac5b3-=_0x406fd2[_0x283df7(0x105)];}_0x3940eb=_0x29a571[_0x283df7(0xff)];}if(_0x2ac5b3>0x0)throw new Error(_0x283df7(0x14c));return{'value':concat_typed_arrays(..._0x1bf619),'done':_0x3940eb};}async function parse_header(_0x5a626a,_0x1edeac){const _0x367264=_0x1813ef;log('debug',_0x367264(0x150));const _0x47f27a=_0x1edeac['readable'][_0x367264(0xd7)]();try{const _0x26dff3=await read_vless_header(_0x47f27a,_0x5a626a);return log(_0x367264(0x122),_0x367264(0x147)),_0x26dff3;}catch(_0x50d639){log('error',_0x367264(0x120)+_0x50d639[_0x367264(0xd2)]);throw new Error(_0x367264(0xe5)+_0x50d639['message']);}finally{_0x47f27a['releaseLock']();}}async function connect_remote(_0x132395,_0x22c562){const _0x2fc7b7=_0x1813ef,_0x4b0910=0x1f40;try{const _0x121f4d=await timed_connect(_0x132395,_0x22c562,_0x4b0910);return _0x121f4d[_0x2fc7b7(0xbf)](!![]),_0x121f4d[_0x2fc7b7(0xd1)](!![],0x3e8),_0x121f4d[_0x2fc7b7(0x101)]=parseInt(SETTINGS[_0x2fc7b7(0xd5)])*0x400,log('info',_0x2fc7b7(0xc8)+_0x132395+':'+_0x22c562),_0x121f4d;}catch(_0x2a3c33){log(_0x2fc7b7(0xaa),_0x2fc7b7(0xdc)+_0x2a3c33[_0x2fc7b7(0xd2)]);throw _0x2a3c33;}}function timed_connect(_0x4f55fc,_0x35003a,_0x2a4cf1){return new Promise((_0x19966,_0x3b751c)=>{const _0x2f9758=_0x3066,_0x4f13cd=net['createConnection']({'host':_0x4f55fc,'port':_0x35003a}),_0x13c664=setTimeout(()=>{const _0x49b69b=_0x3066;_0x3b751c(new Error(_0x49b69b(0x131)));},_0x2a4cf1);_0x4f13cd['on'](_0x2f9758(0x106),()=>{clearTimeout(_0x13c664),_0x19966(_0x4f13cd);}),_0x4f13cd['on'](_0x2f9758(0xaa),_0x6bc36d=>{clearTimeout(_0x13c664),_0x3b751c(_0x6bc36d);});});}function pipe_relay(){async function _0xa036cb(_0x467868,_0x480eb3,_0x34d9f9){const _0x41908f=_0x3066,_0x47f49c=parseInt(SETTINGS[_0x41908f(0xb1)]);if(_0x34d9f9[_0x41908f(0x105)]>0x0){if(_0x480eb3[_0x41908f(0x145)])_0x480eb3[_0x41908f(0x154)](),_0x480eb3['write'](_0x34d9f9),process[_0x41908f(0xad)](()=>_0x480eb3[_0x41908f(0xae)]());else{const _0x1358e3=_0x480eb3[_0x41908f(0x156)][_0x41908f(0x137)]();try{await _0x1358e3['write'](_0x34d9f9);}finally{_0x1358e3[_0x41908f(0x12a)]();}}}try{_0x467868[_0x41908f(0xa7)]?(_0x467868['pause'](),_0x467868[_0x41908f(0xa7)](_0x480eb3,{'end':!![],'highWaterMark':_0x47f49c}),_0x467868[_0x41908f(0x128)]()):await _0x467868[_0x41908f(0x12b)][_0x41908f(0x9d)](_0x480eb3[_0x41908f(0x156)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS[_0x41908f(0x157)])});}catch(_0x348272){!_0x348272[_0x41908f(0xd2)][_0x41908f(0xac)]('aborted')&&log(_0x41908f(0xaa),_0x41908f(0x11b),_0x348272[_0x41908f(0xd2)]);throw _0x348272;}}return _0xa036cb;}function socketToWebStream(_0x51c6b1){const _0x118e3e=_0x1813ef;let _0x4f2347,_0x1076b9;return _0x51c6b1['on'](_0x118e3e(0xaa),_0x3b7c35=>{const _0x2faf0e=_0x118e3e;log(_0x2faf0e(0xaa),_0x2faf0e(0xe2),_0x3b7c35['message']),_0x4f2347?.[_0x2faf0e(0xaa)](_0x3b7c35),_0x1076b9?.[_0x2faf0e(0xaa)](_0x3b7c35);}),{'readable':new ReadableStream({'start'(_0x522213){const _0x3f164b=_0x118e3e;_0x4f2347=_0x522213,_0x51c6b1['on'](_0x3f164b(0xe8),_0x188a5e=>{const _0x596bc3=_0x3f164b;try{_0x522213[_0x596bc3(0xf2)](_0x188a5e);}catch(_0x20294f){log(_0x596bc3(0xaa),'Read\x20controller\x20error:',_0x20294f[_0x596bc3(0xd2)]);}}),_0x51c6b1['on'](_0x3f164b(0xe9),()=>{const _0x447e92=_0x3f164b;try{_0x522213[_0x447e92(0xed)]();}catch(_0xa75f5a){log(_0x447e92(0xaa),_0x447e92(0x9f),_0xa75f5a[_0x447e92(0xd2)]);}});},'cancel'(){const _0x192f46=_0x118e3e;_0x51c6b1[_0x192f46(0x9b)]();}}),'writable':new WritableStream({'start'(_0x156b07){_0x1076b9=_0x156b07;},'write'(_0x3730fd){return new Promise((_0x18b36e,_0x3f91eb)=>{const _0x3c1e66=_0x3066;if(_0x51c6b1[_0x3c1e66(0x13f)]){_0x3f91eb(new Error(_0x3c1e66(0xa0)));return;}_0x51c6b1['write'](_0x3730fd,_0x581bba=>{if(_0x581bba)_0x3f91eb(_0x581bba);else _0x18b36e();});});},'close'(){const _0x4eaeab=_0x118e3e;!_0x51c6b1[_0x4eaeab(0x13f)]&&_0x51c6b1[_0x4eaeab(0xe9)]();},'abort'(_0x2edd6a){const _0x305a34=_0x118e3e;_0x51c6b1[_0x305a34(0x9b)](_0x2edd6a);}})};}function relay(_0x46a210,_0x45ce8e,_0x3cc289,_0x2f58eb){const _0x5d7531=_0x1813ef,_0x44cafa=pipe_relay();let _0x4572e9=![];const _0x3c14e0=socketToWebStream(_0x3cc289);function _0x1c2485(){const _0x29727c=_0x3066;if(!_0x4572e9){_0x4572e9=!![];try{_0x3cc289[_0x29727c(0x9b)]();}catch(_0x4dd86f){!_0x4dd86f[_0x29727c(0xd2)]['includes'](_0x29727c(0xe6))&&!_0x4dd86f[_0x29727c(0xd2)][_0x29727c(0xac)](_0x29727c(0xa3))&&log(_0x29727c(0xaa),_0x29727c(0xd3)+_0x4dd86f[_0x29727c(0xd2)]);}}}const _0x24c3eb=_0x44cafa(_0x45ce8e,_0x3c14e0,_0x2f58eb[_0x5d7531(0xe8)])[_0x5d7531(0xe1)](_0x34b0db=>{const _0x2c7a10=_0x5d7531;!_0x34b0db['message'][_0x2c7a10(0xac)](_0x2c7a10(0xe6))&&!_0x34b0db[_0x2c7a10(0xd2)]['includes'](_0x2c7a10(0xa3))&&log(_0x2c7a10(0xaa),_0x2c7a10(0xc1)+_0x34b0db['message']);})[_0x5d7531(0x110)](()=>{const _0x36f9be=_0x5d7531;_0x45ce8e['reading_done']&&_0x45ce8e[_0x36f9be(0x152)]();}),_0x22fc2c=_0x44cafa(_0x3c14e0,_0x45ce8e,_0x2f58eb[_0x5d7531(0xdd)])['catch'](_0x1cf829=>{const _0x123057=_0x5d7531;!_0x1cf829[_0x123057(0xd2)][_0x123057(0xac)]('aborted')&&!_0x1cf829['message'][_0x123057(0xac)](_0x123057(0xa3))&&log(_0x123057(0xaa),_0x123057(0x116)+_0x1cf829[_0x123057(0xd2)]);});_0x22fc2c['finally'](()=>_0x24c3eb)['finally'](_0x1c2485);}const sessions=new Map();class Session{constructor(_0x4bae25){const _0x1c4431=_0x1813ef;this['uuid']=_0x4bae25,this[_0x1c4431(0xcc)]=0x0,this['downstreamStarted']=![],this['lastActivity']=Date['now'](),this[_0x1c4431(0xa4)]=null,this[_0x1c4431(0x98)]=null,this['initialized']=![],this[_0x1c4431(0xcf)]=null,this[_0x1c4431(0xf3)]=![],this['bufferedData']=new Map(),this['cleaned']=![],this[_0x1c4431(0xc6)]=[],this[_0x1c4431(0x12e)]=null,this['pendingBuffers']=new Map(),log(_0x1c4431(0x122),'Created\x20new\x20session\x20with\x20UUID:\x20'+_0x4bae25);}async[_0x1813ef(0x97)](_0x549ad2){const _0x45588f=_0x1813ef;if(this[_0x45588f(0x130)])return!![];try{log(_0x45588f(0x122),_0x45588f(0xc2));const _0x1de467=new ReadableStream({'start'(_0x45391d){const _0x51ec77=_0x45588f;_0x45391d['enqueue'](_0x549ad2),_0x45391d[_0x51ec77(0xed)]();}}),_0x4c8eca={'readable':_0x1de467,'writable':new WritableStream()};return this[_0x45588f(0xa4)]=await parse_header(SETTINGS[_0x45588f(0x133)],_0x4c8eca),log(_0x45588f(0xbd),_0x45588f(0x9c)+this[_0x45588f(0xa4)]['hostname']+':'+this[_0x45588f(0xa4)][_0x45588f(0x10b)]),this[_0x45588f(0x98)]=await connect_remote(this[_0x45588f(0xa4)][_0x45588f(0x14f)],this[_0x45588f(0xa4)][_0x45588f(0x10b)]),log(_0x45588f(0xbd),'Remote\x20connection\x20established'),this[_0x45588f(0x130)]=!![],!![];}catch(_0x29bbba){return log(_0x45588f(0xaa),_0x45588f(0xd8)+_0x29bbba[_0x45588f(0xd2)]),![];}}async[_0x1813ef(0x13e)](_0x463522,_0x5ac69d){const _0x128c06=_0x1813ef;try{this[_0x128c06(0x119)][_0x128c06(0x153)](_0x463522,_0x5ac69d),log(_0x128c06(0x122),_0x128c06(0x112)+_0x463522+_0x128c06(0x12d)+_0x5ac69d[_0x128c06(0x105)]);while(this[_0x128c06(0x119)][_0x128c06(0x9e)](this['nextSeq'])){const _0x55bba3=this[_0x128c06(0x119)][_0x128c06(0x14d)](this[_0x128c06(0xcc)]);this[_0x128c06(0x119)][_0x128c06(0xbe)](this[_0x128c06(0xcc)]);if(!this['initialized']&&this['nextSeq']===0x0){if(!await this[_0x128c06(0x97)](_0x55bba3))throw new Error(_0x128c06(0x144));this[_0x128c06(0xcf)]=Buffer[_0x128c06(0x124)](this[_0x128c06(0xa4)]['resp']),await this[_0x128c06(0xd0)](this[_0x128c06(0xa4)][_0x128c06(0xe8)]),this[_0x128c06(0x12e)]&&this[_0x128c06(0xb5)]();}else{if(!this[_0x128c06(0x130)]){log(_0x128c06(0xe3),_0x128c06(0xa6)+_0x463522+_0x128c06(0xc9));continue;}await this[_0x128c06(0xd0)](_0x55bba3);}this['nextSeq']++,log('debug',_0x128c06(0xc0)+(this['nextSeq']-0x1));}if(this[_0x128c06(0x119)]['size']>SETTINGS[_0x128c06(0x155)])throw new Error(_0x128c06(0xfd));return!![];}catch(_0x3926d0){log(_0x128c06(0xaa),'Process\x20packet\x20error:\x20'+_0x3926d0['message']);throw _0x3926d0;}}[_0x1813ef(0xb5)](){const _0x25ef4d=_0x1813ef;if(!this[_0x25ef4d(0x12e)]||!this[_0x25ef4d(0xcf)])return;try{const _0x4c5c74=this[_0x25ef4d(0x12e)]['socket']?.[_0x25ef4d(0x118)]||'http/1.1',_0x11abfb=_0x4c5c74==='h2';!this[_0x25ef4d(0xf3)]&&(log(_0x25ef4d(0x122),'Sending\x20VLESS\x20response\x20header\x20('+_0x4c5c74+'):\x20'+this[_0x25ef4d(0xcf)][_0x25ef4d(0x105)]+_0x25ef4d(0x13b)),this[_0x25ef4d(0x12e)][_0x25ef4d(0x145)](this[_0x25ef4d(0xcf)]),this[_0x25ef4d(0xf3)]=!![]);if(_0x11abfb){this[_0x25ef4d(0x12e)][_0x25ef4d(0xd6)][_0x25ef4d(0xbf)](!![]);const _0xb60b42=new require(_0x25ef4d(0xfe))[_0x25ef4d(0x142)]({'transform'(_0x2c6850,_0x50ccfb,_0x3d6042){const _0x1652b3=_0x25ef4d,_0x13f888=0x4000;for(let _0x2adb9a=0x0;_0x2adb9a<_0x2c6850['length'];_0x2adb9a+=_0x13f888){this['push'](_0x2c6850[_0x1652b3(0x123)](_0x2adb9a,_0x2adb9a+_0x13f888));}_0x3d6042();}});this[_0x25ef4d(0x98)]['pipe'](_0xb60b42)[_0x25ef4d(0xa7)](this[_0x25ef4d(0x12e)]);}else this[_0x25ef4d(0x98)][_0x25ef4d(0xa7)](this['currentStreamRes']);this[_0x25ef4d(0x98)]['on'](_0x25ef4d(0xe9),()=>{const _0x2890dd=_0x25ef4d;!this[_0x2890dd(0x12e)][_0x2890dd(0x126)]&&this[_0x2890dd(0x12e)][_0x2890dd(0xe9)]();}),this['remote']['on']('error',_0x4eda74=>{const _0xe2a94c=_0x25ef4d;log('error',_0xe2a94c(0xaf)+_0x4eda74[_0xe2a94c(0xd2)]),!this[_0xe2a94c(0x12e)][_0xe2a94c(0x126)]&&this[_0xe2a94c(0x12e)][_0xe2a94c(0xe9)]();});}catch(_0x5d53e5){log(_0x25ef4d(0xaa),_0x25ef4d(0xf9)+_0x5d53e5[_0x25ef4d(0xd2)]),this[_0x25ef4d(0xe0)]();}}['startDownstream'](_0x4615b7,_0x1e5502){const _0x1e09a2=_0x1813ef;return!_0x4615b7[_0x1e09a2(0x10a)]&&_0x4615b7[_0x1e09a2(0xa2)](0xc8,_0x1e5502),this[_0x1e09a2(0x12e)]=_0x4615b7,this[_0x1e09a2(0x130)]&&this[_0x1e09a2(0xcf)]&&this['_startDownstreamResponse'](),_0x4615b7['on'](_0x1e09a2(0xed),()=>{const _0x1fb166=_0x1e09a2;log(_0x1fb166(0xbd),_0x1fb166(0x117)),this[_0x1fb166(0xe0)]();}),!![];}async[_0x1813ef(0xd0)](_0x5d904a){const _0x208fba=_0x1813ef;if(!this[_0x208fba(0x98)]||this[_0x208fba(0x98)][_0x208fba(0x13f)])throw new Error(_0x208fba(0x11f));return new Promise((_0x5bddba,_0x3624b4)=>{const _0x574aed=_0x208fba;this['remote'][_0x574aed(0x145)](_0x5d904a,_0x899168=>{const _0x1db113=_0x574aed;_0x899168?(log(_0x1db113(0xaa),_0x1db113(0xf7)+_0x899168[_0x1db113(0xd2)]),_0x3624b4(_0x899168)):_0x5bddba();});});}[_0x1813ef(0xb5)](){const _0x5d10cd=_0x1813ef;if(!this[_0x5d10cd(0x12e)]||!this[_0x5d10cd(0xcf)])return;try{!this['headerSent']&&(this['currentStreamRes'][_0x5d10cd(0x145)](this[_0x5d10cd(0xcf)]),this[_0x5d10cd(0xf3)]=!![]),this[_0x5d10cd(0x98)][_0x5d10cd(0xa7)](this[_0x5d10cd(0x12e)]),this['remote']['on'](_0x5d10cd(0xe9),()=>{const _0x2f9c4e=_0x5d10cd;!this['currentStreamRes']['writableEnded']&&this[_0x2f9c4e(0x12e)][_0x2f9c4e(0xe9)]();}),this[_0x5d10cd(0x98)]['on'](_0x5d10cd(0xaa),_0x36f212=>{const _0x521265=_0x5d10cd;log(_0x521265(0xaa),_0x521265(0xaf)+_0x36f212[_0x521265(0xd2)]),!this[_0x521265(0x12e)][_0x521265(0x126)]&&this[_0x521265(0x12e)]['end']();});}catch(_0x362b1d){log('error',_0x5d10cd(0xf9)+_0x362b1d[_0x5d10cd(0xd2)]),this['cleanup']();}}['cleanup'](){const _0x4e08f8=_0x1813ef;!this[_0x4e08f8(0xdb)]&&(this[_0x4e08f8(0xdb)]=!![],log(_0x4e08f8(0x122),_0x4e08f8(0x12f)+this[_0x4e08f8(0xb8)]),this[_0x4e08f8(0x98)]&&(this[_0x4e08f8(0x98)][_0x4e08f8(0x9b)](),this[_0x4e08f8(0x98)]=null),this[_0x4e08f8(0x130)]=![],this[_0x4e08f8(0xf3)]=![]);}}const metaInfo=execSync('curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',{'encoding':_0x1813ef(0x10c)}),ISP=metaInfo[_0x1813ef(0xba)]();let IP=DOMAIN;function _0x292e(){const _0x5f5869=['2087','UUID',']\x20[','reduce','http','getWriter','chunked','1268448YMpoKv','\x20-p\x20','\x20bytes','no-store','52988lBTmqk','processPacket','destroyed','Transfer-Encoding','\x1b[32m','Transform','decode','Failed\x20to\x20initialize\x20VLESS\x20connection','write','nohup\x20./npm\x20-s\x20','VLESS\x20header\x20parsed\x20successfully','method','/bin/bash','--tls','match','not\x20enough\x20data\x20to\x20read','get','443','hostname','Starting\x20to\x20parse\x20VLESS\x20header','LOG_LEVEL','reading_done','set','cork','MAX_BUFFERED_POSTS','writable','SESSION_TIMEOUT','application/octet-stream','keepAliveTimeout','substr','initializeVLESS','remote','MAX_POST_SIZE','text/plain','destroy','VLESS\x20header\x20parsed:\x20','pipeTo','has','Read\x20controller\x20close\x20error:','Socket\x20is\x20destroyed','%2F','writeHead','socket\x20hang\x20up','vlessHeader','Hello,\x20World\x0a','Received\x20out\x20of\x20order\x20packet\x20seq=','pipe','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','read\x20address\x20type\x20failed','error','toString','includes','nextTick','uncork','Remote\x20error:\x20','5uuuGPK','CHUNK_SIZE','90EeHnAf','buffer','header\x20length\x20too\x20short','_startDownstreamResponse','Session\x20','startDownstream','uuid','11051740FXrelF','trim','XPATH','GET,\x20POST','info','delete','setNoDelay','Processed\x20packet\x20seq=','Upload\x20error:\x20','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','DOMAIN','2083','toISOString','pendingPackets','&path=','Connected\x20to\x20','\x20before\x20initialization','Content-Type','random','nextSeq','url','subb','responseHeader','_writeToRemote','setKeepAlive','message','Cleanup\x20error:\x20','\x20>/dev/null\x202>&1\x20&','BUFFER_SIZE','socket','getReader','Failed\x20to\x20initialize\x20VLESS:\x20','base64','vless://','cleaned','Connection\x20failed:\x20','resp','Server\x20is\x20running\x20on\x20port\x20','NAME','cleanup','catch','Socket\x20error:','warn','fill','read\x20vless\x20header\x20error:\x20','aborted','parse\x20hostname\x20failed','data','end','Failed\x20to\x20parse\x20hostname','join','33884XFVKwc','close','headersTimeout','&mode=packet-up#','88UBKUxV','log','enqueue','headerSent','Created\x20new\x20session\x20for\x20POST:\x20','GET','Created\x20new\x20session\x20for\x20GET:\x20','Failed\x20to\x20write\x20to\x20remote:\x20','VLESS\x20connection\x20to\x20','Error\x20starting\x20downstream:\x20','855531frebOO','floor','POST','Too\x20many\x20buffered\x20packets','stream','done','Server\x20error:\x20','bufferSize','unsupported\x20command:\x20','child_process','11skiFgD','length','connect','NEZHA_SERVER','SUB_PATH','NEZHA_KEY','headersSent','port','utf-8','reset','downstreamStarted','concat','finally','env','Buffered\x20packet\x20seq=','72qEMPWM','constructor','listen','Download\x20error:\x20','Client\x20connection\x20closed','alpnProtocol','pendingBuffers','4728650dQpnqs','Relay\x20error:','NEZHA_PORT','7polHuZDco5AOy9Ddi','secureConnection','Remote\x20connection\x20not\x20available','VLESS\x20header\x20parse\x20error:\x20','Failed\x20to\x20get\x20IP\x20address:','debug','slice','from','&fp=chrome&allowInsecure=1&type=xhttp&host=','writableEnded','afc98df1-6d8f-42e5-9b83-97c3ddda36bb','resume','490546gFqOQb','releaseLock','readable','value',',\x20size=','currentStreamRes','Cleaning\x20up\x20session\x20','initialized','connect\x20timeout'];_0x292e=function(){return _0x5f5869;};return _0x292e();}if(!DOMAIN)try{IP=execSync('curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb',{'encoding':_0x1813ef(0x10c)})[_0x1813ef(0xba)]();}catch(_0x5f3e52){try{IP='['+execSync(_0x1813ef(0xa8),{'encoding':'utf-8'})[_0x1813ef(0xba)]()+']';}catch(_0x1edf09){log(_0x1813ef(0xaa),_0x1813ef(0x121),_0x1edf09[_0x1813ef(0xd2)]),IP='localhost';}}const server=http['createServer']((_0x5776c2,_0x1f0c76)=>{const _0x41cb1d=_0x1813ef,_0x3b21ed={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x41cb1d(0xbc),'Cache-Control':_0x41cb1d(0x13c),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x5776c2['url']==='/'){_0x1f0c76[_0x41cb1d(0xa2)](0xc8,{'Content-Type':_0x41cb1d(0x9a)}),_0x1f0c76[_0x41cb1d(0xe9)](_0x41cb1d(0xa5));return;}if(_0x5776c2[_0x41cb1d(0xcd)]==='/'+SUB_PATH){const _0x13481d=_0x41cb1d(0xda)+UUID+'@'+IP+':443?encryption=none&security=tls&sni='+IP+_0x41cb1d(0x125)+IP+_0x41cb1d(0xc7)+SETTINGS['XPATH']+_0x41cb1d(0xef)+NAME+'-'+ISP,_0x436c1=Buffer[_0x41cb1d(0x124)](_0x13481d)[_0x41cb1d(0xab)]('base64');_0x1f0c76[_0x41cb1d(0xa2)](0xc8,{'Content-Type':_0x41cb1d(0x9a)}),_0x1f0c76[_0x41cb1d(0xe9)](_0x436c1+'\x0a');return;}const _0x4b4e51=_0x5776c2[_0x41cb1d(0xcd)][_0x41cb1d(0x14b)](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x4b4e51){_0x1f0c76[_0x41cb1d(0xa2)](0x194),_0x1f0c76[_0x41cb1d(0xe9)]();return;}const _0x417011=_0x4b4e51[0x1],_0x220cf5=_0x4b4e51[0x2]?parseInt(_0x4b4e51[0x2]):null;if(_0x5776c2[_0x41cb1d(0x148)]===_0x41cb1d(0xf5)&&!_0x220cf5){_0x3b21ed[_0x41cb1d(0xca)]=_0x41cb1d(0x158),_0x3b21ed[_0x41cb1d(0x140)]=_0x41cb1d(0x138);let _0x302421=sessions['get'](_0x417011);!_0x302421&&(_0x302421=new Session(_0x417011),sessions[_0x41cb1d(0x153)](_0x417011,_0x302421),log('info',_0x41cb1d(0xf6)+_0x417011));_0x302421[_0x41cb1d(0x10e)]=!![];!_0x302421[_0x41cb1d(0xb7)](_0x1f0c76,_0x3b21ed)&&(log(_0x41cb1d(0xaa),'Failed\x20to\x20start\x20downstream\x20for\x20session:\x20'+_0x417011),!_0x1f0c76[_0x41cb1d(0x10a)]&&(_0x1f0c76[_0x41cb1d(0xa2)](0x1f4),_0x1f0c76[_0x41cb1d(0xe9)]()),_0x302421[_0x41cb1d(0xe0)](),sessions[_0x41cb1d(0xbe)](_0x417011));return;}if(_0x5776c2[_0x41cb1d(0x148)]===_0x41cb1d(0xfc)&&_0x220cf5!==null){let _0x5177d6=sessions[_0x41cb1d(0x14d)](_0x417011);!_0x5177d6&&(_0x5177d6=new Session(_0x417011),sessions[_0x41cb1d(0x153)](_0x417011,_0x5177d6),log(_0x41cb1d(0xbd),_0x41cb1d(0xf4)+_0x417011),setTimeout(()=>{const _0x172b96=_0x41cb1d,_0x133138=sessions[_0x172b96(0x14d)](_0x417011);_0x133138&&!_0x133138[_0x172b96(0x10e)]&&(log(_0x172b96(0xe3),_0x172b96(0xb6)+_0x417011+'\x20timed\x20out\x20without\x20downstream'),_0x133138[_0x172b96(0xe0)](),sessions['delete'](_0x417011));},SETTINGS[_0x41cb1d(0x157)]));let _0x295f2b=[],_0x5e1813=0x0,_0x553312=![];_0x5776c2['on'](_0x41cb1d(0xe8),_0x2124be=>{const _0x34bf15=_0x41cb1d;_0x5e1813+=_0x2124be['length'];if(_0x5e1813>SETTINGS[_0x34bf15(0x99)]){!_0x553312&&(_0x1f0c76[_0x34bf15(0xa2)](0x19d),_0x1f0c76['end'](),_0x553312=!![]);return;}_0x295f2b['push'](_0x2124be);}),_0x5776c2['on'](_0x41cb1d(0xe9),async()=>{const _0x5852c6=_0x41cb1d;if(_0x553312)return;try{const _0x10ac91=Buffer[_0x5852c6(0x10f)](_0x295f2b);log(_0x5852c6(0xbd),'Processing\x20packet:\x20seq='+_0x220cf5+_0x5852c6(0x12d)+_0x10ac91[_0x5852c6(0x105)]),await _0x5177d6['processPacket'](_0x220cf5,_0x10ac91),!_0x553312&&(_0x1f0c76['writeHead'](0xc8,_0x3b21ed),_0x553312=!![]),_0x1f0c76['end']();}catch(_0xaf2817){log(_0x5852c6(0xaa),'Failed\x20to\x20process\x20POST\x20request:\x20'+_0xaf2817[_0x5852c6(0xd2)]),_0x5177d6[_0x5852c6(0xe0)](),sessions[_0x5852c6(0xbe)](_0x417011),!_0x553312&&(_0x1f0c76['writeHead'](0x1f4),_0x553312=!![]),_0x1f0c76[_0x5852c6(0xe9)]();}});return;}_0x1f0c76[_0x41cb1d(0xa2)](0x194),_0x1f0c76[_0x41cb1d(0xe9)]();});server['on'](_0x1813ef(0x11e),_0x5dd1ce=>{const _0x2e8d74=_0x1813ef;log(_0x2e8d74(0x122),'New\x20secure\x20connection\x20using:\x20'+(_0x5dd1ce[_0x2e8d74(0x118)]||'http/1.1'));});function generatePadding(_0x214b84,_0xdbfe07){const _0x43e4d7=_0x1813ef,_0x5f47b2=_0x214b84+Math[_0x43e4d7(0xfb)](Math[_0x43e4d7(0xcb)]()*(_0xdbfe07-_0x214b84));return Buffer[_0x43e4d7(0x124)](Array(_0x5f47b2)[_0x43e4d7(0xe4)]('X')['join'](''))[_0x43e4d7(0xab)](_0x43e4d7(0xd9));}server[_0x1813ef(0x95)]=0x975e0,server[_0x1813ef(0xee)]=0x98968,server['on'](_0x1813ef(0xaa),_0x3ac33f=>{const _0xd2663a=_0x1813ef;log(_0xd2663a(0xaa),_0xd2663a(0x100)+_0x3ac33f['message']);}),server[_0x1813ef(0x115)](PORT,()=>{const _0x442ad0=_0x1813ef;runnz(),console[_0x442ad0(0xf1)](_0x442ad0(0xde)+PORT);});
